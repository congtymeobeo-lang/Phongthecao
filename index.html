<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PhongCard ‚Äî Sang tr·ªçng</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#060712;
  --panel:#0f1720;
  --muted:#9aa9bb;
  --glass: rgba(255,255,255,0.03);
  --accent1: #7dd3fc;
  --accent2: #9b8cff;
  --accent3: #60a5fa;
  --good:#34d399;
  --bad:#fb7185;
  --card-shadow: 0 10px 30px rgba(2,6,23,0.6);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#e6f7ff;background:linear-gradient(180deg,#041026 0%,var(--bg) 100%);}
.app{max-width:980px;margin:8px auto;padding:8px;min-height:calc(100vh - 96px);display:grid;grid-template-columns:1fr 340px;gap:12px}
@media(max-width:900px){ .app{grid-template-columns:1fr;padding:8px} .right{order:2} .left{order:1} }

/* header */
header{height:64px;display:flex;align-items:center;gap:12px;padding:8px 12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);box-shadow:var(--card-shadow)}
.logo{width:52px;height:44;border-radius:10px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#022}
.brand{display:flex;flex-direction:column}
.title{font-weight:700}
.subtitle{font-size:12px;color:var(--muted)}

.sp{flex:1}
.top-actions{display:flex;gap:8px;align-items:center}

/* card */
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:var(--card-shadow)}
h2{margin:0 0 8px 0}
.small{font-size:13px;color:var(--muted)}
.muted-note{color:var(--muted);font-size:13px}

/* sections */
.section{display:none;opacity:0;transform:translateY(8px);transition:all .28s ease}
.section.active{display:block;opacity:1;transform:none}

/* controls */
input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.row{display:flex;gap:8px;align-items:center}
.btn{padding:8px 12px;border-radius:10px;border:0;background:transparent;color:var(--muted);cursor:pointer}
.btn:active{transform:scale(0.98)}
.btn-primary{background:linear-gradient(90deg,var(--accent1),var(--accent3));color:#042;font-weight:700;padding:9px 12px;border-radius:10px;cursor:pointer;box-shadow:0 8px 26px rgba(96,165,250,0.07)}

/* bottom nav */
.bottom-nav{position:fixed;left:50%;transform:translateX(-50%);bottom:12px;width:min(960px,96%);display:flex;justify-content:space-between;background:linear-gradient(180deg,rgba(8,12,18,0.9),rgba(6,8,12,0.85));padding:8px;border-radius:14px;border:1px solid rgba(255,255,255,0.03);z-index:110}
.nav-item{flex:1;text-align:center;padding:8px;border-radius:10px;color:var(--muted);cursor:pointer}
.nav-item.active{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#022;font-weight:700}
.nav-icon{font-size:18px;display:block}

/* wheel */
.wheel-wrap{display:flex;flex-direction:column;align-items:center;gap:10px}
.wheel{width:300px;height:300px;border-radius:50%;overflow:hidden;border:12px solid rgba(255,255,255,0.03);position:relative;transition:transform 4s cubic-bezier(.2,.9,.2,1)}
.pointer{width:0;height:0;border-left:20px solid transparent;border-right:20px solid transparent;border-bottom:34px solid var(--accent1);margin-top:-12px}
.slice{position:absolute;width:50%;height:50%;left:50%;top:50%;transform-origin:0 0;display:flex;align-items:center;justify-content:center;font-weight:800}

/* history */
.history-list{max-height:420px;overflow:auto;padding:8px;border-radius:8px;background:rgba(0,0,0,0.05)}
.history-item{padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);margin-bottom:8px}

/* mini games */
.game-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}

/* preview */
.bg-preview{width:100%;height:120px;border-radius:8px;background-size:cover;background-position:center;border:1px solid rgba(255,255,255,0.03)}

/* loader small */
.loader-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.5);z-index:300;opacity:0;pointer-events:none;transition:opacity .18s}
.loader-overlay.show{opacity:1;pointer-events:auto}
.loader-box{background:linear-gradient(90deg,var(--accent2),var(--accent1));padding:12px;border-radius:10px;color:#022;font-weight:800}

/* ripple */
.ripple{position:relative;overflow:hidden}
.ripple:after{content:"";position:absolute;width:6px;height:6px;background:rgba(255,255,255,0.08);left:50%;top:50%;transform:translate(-50%,-50%);border-radius:50%;opacity:0;transition:all .5s}
.ripple:active:after{width:260px;height:260px;opacity:1;transition:all .5s}

/* responsive */
@media(max-width:760px){
  .app{grid-template-columns:1fr;padding:10px}
  .wheel{width:260px;height:260px}
  .bg-preview{height:90px}
}
</style>
</head>
<body>

<header>
  <div class="logo">P</div>
  <div class="brand"><div class="title">PhongCard</div><div class="subtitle small">Sang tr·ªçng ‚Äî Coin & Mini-game</div></div>
  <div class="sp"></div>
  <div class="top-actions">
    <div id="coinBadge" class="small">0 Xu</div>
    <button id="musicBtn" class="btn btn-primary">üéµ Nh·∫°c</button>
  </div>
</header>

<div class="app">
  <!-- LEFT main -->
  <div class="left">
    <!-- HOME -->
    <section id="home" class="card section active">
      <h2>Dashboard</h2>
      <p class="small">Xin ch√†o ‚Äî Trang qu·∫£n l√Ω, coin & l∆∞·ª£t quay, mini-game.</p>
      <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
        <div style="flex:1;min-width:140px" class="card">
          <div class="small">T√†i kho·∫£n</div>
          <div id="uiUser" style="font-weight:800;margin-top:8px">Ch∆∞a ƒëƒÉng nh·∫≠p</div>
        </div>
        <div style="flex:1;min-width:140px" class="card">
          <div class="small">Coin</div>
          <div id="uiCoin" style="font-weight:800;margin-top:8px">0 Xu</div>
        </div>
        <div style="flex:1;min-width:140px" class="card">
          <div class="small">L∆∞·ª£t quay</div>
          <div id="uiSpins" style="font-weight:800;margin-top:8px">0</div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="small">·∫¢nh Dashboard (t√πy ch·ªânh)</div>
        <div id="homePreview" class="bg-preview" style="margin-top:8px"></div>
        <div class="muted-note" style="margin-top:8px">Upload ·∫£nh trong tab T√†i kho·∫£n ‚Üí l∆∞u local.</div>
      </div>
    </section>

    <!-- Giftcode -->
    <section id="giftcode" class="card section">
      <h2>Nh·∫≠p Giftcode</h2>
      <p class="small">PHONGCARDxxx = +1 l∆∞·ª£t, PHONGVIPxxx = +2 l∆∞·ª£t & VIP, PHONGGIFTxxx = coin.</p>
      <div class="row" style="margin-top:8px">
        <input id="codeField" placeholder="Nh·∫≠p code...">
        <button id="applyCode" class="btn-primary ripple">√Åp d·ª•ng</button>
      </div>
      <div id="codeMsg" class="small" style="margin-top:8px"></div>

      <div class="card" style="margin-top:12px">
        <div class="small">·∫¢nh trang Giftcode</div>
        <div id="redeemPreview" class="bg-preview" style="margin-top:8px"></div>
      </div>
    </section>

    <!-- Wheel -->
    <section id="wheel" class="card section">
      <h2>V√≤ng quay</h2>
      <p class="small">T·ªâ l·ªá: 10% ‚Üí 7k, 20% ‚Üí 5k, 40% ‚Üí 2/3/4k, 30% ‚Üí c√¢u chuy·ªán</p>
      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px">
        <div style="flex:1;min-width:260px" class="card">
          <div class="wheel-wrap">
            <div class="pointer"></div>
            <div id="wheelEl" class="wheel" aria-hidden="true"></div>
            <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
              <button id="spinBtn" class="btn-primary ripple">Quay ngay</button>
              <div id="spinInfo" class="small"></div>
            </div>
            <div id="spinResult" class="small" style="margin-top:8px"></div>
          </div>
        </div>
        <div style="width:300px">
          <div class="card">
            <div class="small">VIP</div>
            <div id="vipInfo" class="muted-note" style="margin-top:8px"></div>
          </div>
          <div class="card" style="margin-top:12px">
            <div class="small">·∫¢nh v√≤ng quay</div>
            <div id="wheelPreview" class="bg-preview" style="margin-top:8px"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- History -->
    <section id="history" class="card section">
      <h2>L·ªãch s·ª≠</h2>
      <p class="small">C√°c ph·∫ßn th∆∞·ªüng ƒë√£ nh·∫≠n theo t√†i kho·∫£n.</p>
      <div id="historyList" class="history-list" style="margin-top:10px">Ch∆∞a c√≥ l·ªãch s·ª≠</div>
    </section>

    <!-- Earn / Mini-games -->
    <section id="earn" class="card section">
      <h2>Ki·∫øm ti·ªÅn ‚Äî Mini-game</h2>
      <p class="small">Tung x√∫c x·∫Øc & C√¢u c√° ‚Äî ki·∫øm Xu nhanh.</p>

      <div class="card" style="margin-top:10px">
        <h3>Tung x√∫c x·∫Øc</h3>
        <div style="display:flex;gap:10px;align-items:center;margin-top:8px">
          <div id="dieA" style="font-size:44px">‚öÄ</div>
          <div id="dieB" style="font-size:44px">‚öÄ</div>
        </div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="roll" class="btn-primary ripple">Tung</button>
          <div id="rollMsg" class="small" style="align-self:center"></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>C√¢u c√°</h3>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="fish" class="btn-primary ripple">C√¢u</button>
          <div id="fishMsg" class="small" style="align-self:center"></div>
        </div>
      </div>
    </section>

    <!-- Account -->
    <section id="account" class="card section">
      <h2>T√†i kho·∫£n</h2>
      <div id="accountBox">
        <div class="small">B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p</div>
        <div style="margin-top:10px"><button id="openAuth" class="btn-primary ripple">ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</button></div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="small">Upload ·∫£nh cho trang (l∆∞u local)</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input id="upHome" type="file" accept="image/*">
          <input id="upRedeem" type="file" accept="image/*">
          <input id="upWheel" type="file" accept="image/*">
        </div>
        <div class="muted-note" style="margin-top:8px">·∫¢nh l∆∞u trong tr√¨nh duy·ªát, ch·ªâ hi·ªÉn th·ªã tr√™n thi·∫øt b·ªã n√†y.</div>
      </div>
    </section>

  </div>

  <!-- RIGHT quick -->
  <aside class="right card right">
    <div class="card">
      <div class="small">Nh·∫°c n·ªÅn (LoFi)</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="playMusic" class="btn-primary ripple">B·∫≠t</button>
        <button id="pauseMusic" class="btn ripple">T·∫Øt</button>
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="small">G√µ code nhanh</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="sideCode" placeholder="CODE">
        <button id="sideBtn" class="btn-primary ripple">OK</button>
      </div>
      <div id="sideMsg" class="small" style="margin-top:8px"></div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="small">Mini l·ªãch s·ª≠</div>
      <div id="mini" class="history-list small" style="margin-top:8px">Ch∆∞a c√≥</div>
    </div>
  </aside>
</div>

<!-- bottom nav -->
<div class="bottom-nav" id="nav">
  <div class="nav-item active" data-target="home"><div class="nav-icon">üè†</div><div class="small">Home</div></div>
  <div class="nav-item" data-target="giftcode"><div class="nav-icon">üéÅ</div><div class="small">Giftcode</div></div>
  <div class="nav-item" data-target="wheel"><div class="nav-icon">üé°</div><div class="small">Quay</div></div>
  <div class="nav-item" data-target="history"><div class="nav-icon">üìú</div><div class="small">L·ªãch s·ª≠</div></div>
  <div class="nav-item" data-target="earn"><div class="nav-icon">üí∞</div><div class="small">Ki·∫øm</div></div>
  <div class="nav-item" data-target="account" id="navAccount"><div class="nav-icon">üë§</div><div class="small">T√†i kho·∫£n</div></div>
</div>

<!-- loader -->
<div id="loader" class="loader-overlay"><div class="loader-box">ƒêang t·∫£i...</div></div>

<!-- audio (LoFi free) -->
<audio id="bg" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_7b65e8c3f2.mp3?filename=lofi-chill-11293.mp3" type="audio/mpeg">
</audio>

<!-- modal root -->
<div id="modalRoot"></div>

<script>
/* ---------- Data model ---------- */
const STORAGE = 'phongcard_msu_v1';
let DB = JSON.parse(localStorage.getItem(STORAGE) || '{}');
if (!DB.users) DB.users = {};
if (!DB.usedCodes) DB.usedCodes = [];
if (!DB.images) DB.images = {}; // home/redeem/wheel
if (!DB._seeded) {
  for (let i=1;i<=30;i++){ DB['PHONGCARD' + String(i).padStart(3,'0')] = {type:'card'}; }
  DB['PHONGVIP001']={type:'vip'}; DB['PHONGGIFT001']={type:'gift'};
  DB._seeded=true; localStorage.setItem(STORAGE, JSON.stringify(DB));
}
function save(){ localStorage.setItem(STORAGE, JSON.stringify(DB)); }

/* ---------- Session ---------- */
let current = localStorage.getItem(STORAGE + '_session') || null;
if (current && !DB.users[current]) { current = null; localStorage.removeItem(STORAGE + '_session'); }

/* ---------- UI refs ---------- */
const sections = document.querySelectorAll('.section');
const navItems = document.querySelectorAll('.nav-item');
const loader = document.getElementById('loader');

const uiUser = document.getElementById('uiUser');
const uiCoin = document.getElementById('uiCoin');
const uiSpins = document.getElementById('uiSpins');
const coinBadge = document.getElementById('coinBadge');

const codeField = document.getElementById('codeField');
const applyCode = document.getElementById('applyCode');
const codeMsg = document.getElementById('codeMsg');

const sideCode = document.getElementById('sideCode');
const sideBtn = document.getElementById('sideBtn');
const sideMsg = document.getElementById('sideMsg');

const historyList = document.getElementById('historyList');
const mini = document.getElementById('mini');

const dieA = document.getElementById('dieA');
const dieB = document.getElementById('dieB');
const rollBtn = document.getElementById('roll');
const rollMsg = document.getElementById('rollMsg');

const fishBtn = document.getElementById('fish');
const fishMsg = document.getElementById('fishMsg');

const wheelEl = document.getElementById('wheelEl');
const spinBtn = document.getElementById('spinBtn');
const spinResult = document.getElementById('spinResult');

const openAuth = document.getElementById('openAuth');
const accountBox = document.getElementById('accountBox');

const upHome = document.getElementById('upHome');
const upRedeem = document.getElementById('upRedeem');
const upWheel = document.getElementById('upWheel');
const homePreview = document.getElementById('homePreview');
const redeemPreview = document.getElementById('redeemPreview');
const wheelPreview = document.getElementById('wheelPreview');

const playMusic = document.getElementById('playMusic');
const pauseMusic = document.getElementById('pauseMusic');
const bg = document.getElementById('bg');
const musicBtn = document.getElementById('musicBtn');

/* ---------- Navigation ---------- */
navItems.forEach(it=> it.addEventListener('click', ()=> {
  navItems.forEach(n=> n.classList.remove('active'));
  it.classList.add('active');
  const tgt = it.dataset.target;
  navigateTo(tgt);
}));

function showLoader(ms=250){
  loader.classList.add('show'); loader.style.display='flex';
  setTimeout(()=> { loader.classList.remove('show'); loader.style.display='none'; }, ms);
}
function navigateTo(id){
  showLoader(250);
  sections.forEach(s=> s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  // focus for convenience
  if (id === 'giftcode') setTimeout(()=> codeField.focus(), 120);
  if (id === 'wheel') renderWheel();
  renderAll();
}

/* ---------- Auth modal ---------- */
document.getElementById('openAuth').addEventListener('click', openAuthModal);
function openAuthModal(){
  const root = document.getElementById('modalRoot');
  const m = document.createElement('div'); m.className='card modal-back'; m.style.background='rgba(0,0,0,0.45);position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:400';
  m.innerHTML = `<div class="card" style="width:94%;max-width:420px">
    <h3>ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</h3>
    <input id="inUser" placeholder="T√™n t√†i kho·∫£n (kh√¥ng d·∫•u)" />
    <input id="inPass" placeholder="M·∫≠t kh·∫©u" type="password" style="margin-top:8px" />
    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="doLogin" class="btn-primary">ƒêƒÉng nh·∫≠p</button>
      <button id="doReg" class="btn">ƒêƒÉng k√Ω</button>
      <button id="doClose" class="btn">ƒê√≥ng</button>
    </div>
    <div class="muted-note" style="margin-top:8px">D·ªØ li·ªáu l∆∞u c·ª•c b·ªô tr√™n tr√¨nh duy·ªát (local).</div>
  </div>`;
  root.appendChild(m);
  document.getElementById('doClose').onclick = ()=> m.remove();
  document.getElementById('doReg').onclick = ()=> {
    const u = (document.getElementById('inUser').value||'').trim();
    const p = (document.getElementById('inPass').value||'').trim();
    if (!u||!p) return alert('Nh·∫≠p t√™n & m·∫≠t kh·∫©u!');
    if (DB.users[u]) return alert('T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!');
    DB.users[u] = { pass:p, coin:0, spins:0, vipBoost:false, history:[] };
    save();
    current = u; localStorage.setItem(STORAGE + '_session', current);
    m.remove(); toast('ƒêƒÉng k√Ω & ƒëƒÉng nh·∫≠p: '+u); renderAll(); navigateTo('home');
  };
  document.getElementById('doLogin').onclick = ()=> {
    const u = (document.getElementById('inUser').value||'').trim();
    const p = (document.getElementById('inPass').value||'').trim();
    if (!DB.users[u] || DB.users[u].pass !== p) return alert('Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!');
    current = u; localStorage.setItem(STORAGE + '_session', current);
    m.remove(); toast('ƒêƒÉng nh·∫≠p: '+u); renderAll(); navigateTo('home');
  };
}

/* ---------- Giftcode ---------- */
applyCode.addEventListener('click', ()=> handleRedeem(codeField.value));
sideBtn.addEventListener('click', ()=> handleRedeem(sideCode.value));
function normalize(s){ return (s||'').trim().toUpperCase(); }
function handleRedeem(raw){
  const code = normalize(raw);
  if (!current) { showTemp(codeMsg, 'ƒêƒÉng nh·∫≠p ƒë·ªÉ d√πng code', true); return; }
  if (!code) { showTemp(codeMsg, 'Nh·∫≠p code ƒëi', true); return; }
  if (DB.usedCodes.includes(code)) { showTemp(codeMsg, 'Code ƒë√£ d√πng', true); return; }
  if (DB[code] && DB[code].type === 'card') {
    DB.usedCodes.push(code); DB.users[current].spins = (DB.users[current].spins||0) + 1; save(); renderAll();
    showTemp(codeMsg, 'Nh·∫≠n +1 l∆∞·ª£t quay üéâ'); codeField.value=''; sideCode.value=''; return;
  }
  if (/^PHONGVIP\d{1,6}$/.test(code) || (DB[code] && DB[code].type==='vip')) {
    DB.usedCodes.push(code); DB.users[current].spins = (DB.users[current].spins||0) + 2; DB.users[current].vipBoost = true; save(); renderAll(); showTemp(codeMsg, 'PHONGVIP: +2 l∆∞·ª£t & VIP'); codeField.value=''; sideCode.value=''; return;
  }
  if (/^PHONGGIFT\d{1,6}$/.test(code) || (DB[code] && DB[code].type==='gift')) {
    DB.usedCodes.push(code); const vals=[2000,3000,4000,5000,7000]; const money=vals[Math.floor(Math.random()*vals.length)];
    DB.users[current].coin = (DB.users[current].coin||0) + money; DB.users[current].history = DB.users[current].history || [];
    DB.users[current].history.unshift({prize:`${money.toLocaleString()} Xu (GIFT)`, time:new Date().toLocaleString(), value:money});
    save(); renderAll(); renderHistory(); showTemp(codeMsg, `B·∫°n nh·∫≠n ${money.toLocaleString()} Xu`);
