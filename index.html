<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PhongCard ‚Äî Si√™u m∆∞·ª£t (LoFi)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#071026; --card:#0f1a2a; --muted:#9fb3c8;
    --accent1:#60a5fa; --accent2:#6ee7b7; --accent3:#a78bfa;
    --glass: rgba(255,255,255,0.03);
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Arial;color:#e6f2fb;background:var(--bg);-webkit-font-smoothing:antialiased}
  /* Header */
  header{height:64px;display:flex;align-items:center;padding:0 16px;border-bottom:1px solid rgba(255,255,255,0.02);gap:12px}
  .logo{width:44px;height:44;background:linear-gradient(135deg,var(--accent2),var(--accent3));border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:800;color:#042}
  .brand{display:flex;flex-direction:column}
  .title{font-weight:700}
  .subtitle{font-size:12px;color:var(--muted)}
  .sp{flex:1}
  .top-actions{display:flex;gap:8px;align-items:center}
  .btn{background:transparent;border:0;color:var(--muted);padding:8px 10px;border-radius:10px;cursor:pointer}
  .btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent1));border:0;padding:9px 12px;border-radius:10px;color:#042;font-weight:700;cursor:pointer}
  /* App layout (single-column for simplicity) */
  .wrap{max-width:1040px;margin:16px auto;padding:12px;display:grid;grid-template-columns:1fr 360px;gap:16px}
  @media(max-width:960px){ .wrap{grid-template-columns:1fr;padding:12px} .right-col{order:2} .left-col{order:1} }
  .card{background:linear-gradient(180deg,var(--glass), rgba(255,255,255,0.01));padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
  h2{margin:0 0 8px 0}
  .muted{color:var(--muted);font-size:14px}
  input,textarea,select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;margin-top:8px}
  .row{display:flex;gap:8px;align-items:center}
  .small{font-size:13px;color:var(--muted)}
  /* Sections (pages) */
  .section{display:none;opacity:0;transform:translateY(8px);transition:all .36s ease}
  .section.active{display:block;opacity:1;transform:none}
  /* Wheel */
  .wheel-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
  .wheel{width:320px;height:320px;border-radius:50%;overflow:hidden;border:10px solid rgba(255,255,255,0.03);position:relative;transition:transform 4s cubic-bezier(.2,.9,.2,1)}
  .pointer{width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:28px solid var(--accent2);margin-bottom:-8px}
  .slice{position:absolute;width:50%;height:50%;left:50%;top:50%;transform-origin:0 0;display:flex;align-items:center;justify-content:center;font-weight:700}
  .spin-btn{padding:12px 18px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#022;font-weight:800;cursor:pointer}
  /* History */
  .history-list{max-height:420px;overflow:auto;padding:8px;background:rgba(0,0,0,0.08);border-radius:8px}
  .history-item{padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);margin-bottom:8px}
  /* Bottom nav */
  .bottom-nav{position:fixed;left:50%;transform:translateX(-50%);bottom:14px;width:min(980px,96%);display:flex;justify-content:space-between;background:linear-gradient(180deg,rgba(0,0,0,0.22),rgba(0,0,0,0.12));padding:8px;border-radius:14px;border:1px solid rgba(255,255,255,0.03);z-index:80}
  .nav-item{flex:1;text-align:center;padding:8px;border-radius:10px;color:var(--muted);cursor:pointer}
  .nav-item.active{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#022;font-weight:700}
  .nav-item .icon{font-size:18px;display:block}
  /* Modal */
  .modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:200}
  .modal{width:420px;max-width:94%;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px}
  /* Loading overlay */
  .loading-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(0deg, rgba(2,6,23,0.6), rgba(2,6,23,0.4));z-index:150;opacity:0;pointer-events:none;transition:opacity .25s ease}
  .loading-overlay.show{opacity:1;pointer-events:auto}
  .loader{background:linear-gradient(135deg,var(--accent2),var(--accent1));padding:14px;border-radius:12px;font-weight:800;color:#042}
  /* upload preview */
  .bg-preview{width:100%;height:140px;border-radius:10px;background-size:cover;background-position:center;margin-top:10px;border:1px solid rgba(255,255,255,0.03)}
  /* audio control */
  #musicBtn{padding:8px 10px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent3),var(--accent1));color:#022;font-weight:700;cursor:pointer}
  /* small */
  .muted-note{color:var(--muted);font-size:13px}
  @media(max-width:760px){ .wrap{grid-template-columns:1fr;padding:12px} .bottom-nav{bottom:8px} .wheel{width:260px;height:260px} }
</style>
</head>
<body>

<!-- Loading overlay for page transitions -->
<div id="loadingOverlay" class="loading-overlay"><div class="loader">ƒêang t·∫£i...</div></div>

<header>
  <div class="logo">P</div>
  <div class="brand">
    <div class="title">PhongCard</div>
    <div class="subtitle small">Shop giftcode ‚Ä¢ Quay th∆∞·ªüng</div>
  </div>
  <div class="sp"></div>
  <div class="top-actions">
    <button id="imgUploadBtn" class="btn" title="Upload ·∫£nh">üìÅ Upload ·∫£nh</button>
    <button id="musicBtn" class="btn-primary">üîà Nh·∫°c: LoFi</button>
  </div>
</header>

<main class="wrap">
  <!-- LEFT column (main pages) -->
  <div class="left-col">

    <!-- HOME -->
    <section id="homePage" class="card section active">
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <div style="flex:1">
          <h2>Ch√†o m·ª´ng ƒë·∫øn PhongCard</h2>
          <p class="muted">Dashboard anime ‚Äî upload ·∫£nh ri√™ng cho t·ª´ng trang, b·∫≠t/t·∫Øt nh·∫°c LoFi, ƒëƒÉng nh·∫≠p ƒë·ªÉ l∆∞u l·ªãch s·ª≠.</p>
          <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap">
            <div class="card" style="min-width:160px">
              <div class="small">T√†i kho·∫£n</div>
              <div id="userBlock" style="font-weight:700;margin-top:8px">Ch∆∞a ƒëƒÉng nh·∫≠p</div>
            </div>
            <div class="card" style="min-width:160px">
              <div class="small">L∆∞·ª£t quay</div>
              <div id="spinsBlock" style="font-weight:800;margin-top:8px">0</div>
            </div>
            <div class="card" style="min-width:160px">
              <div class="small">S·ªë d∆∞</div>
              <div id="balBlock" style="font-weight:800;margin-top:8px">0 VND</div>
            </div>
          </div>
        </div>
        <div style="width:220px">
          <div class="card">
            <div class="small">·∫¢nh Dashboard</div>
            <div id="homePreview" class="bg-preview"></div>
            <div class="muted-note" style="margin-top:8px">B·∫°n c√≥ th·ªÉ upload ·∫£nh (m√®o) ƒë·ªÉ l√†m background trang ch√†o.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- REDEEM -->
    <section id="redeemPage" class="card section">
      <h2>Nh·∫≠p Giftcode</h2>
      <p class="muted">ƒê·ªãnh d·∫°ng: <code>PHONGCARDxxx</code> | <code>PHONGVIPxxx</code> | <code>PHONGGIFTxxx</code></p>
      <div class="row" style="margin-top:8px">
        <input id="codeInput" placeholder="Nh·∫≠p code...">
        <button id="applyCode" class="btn-primary">√Åp d·ª•ng</button>
      </div>
      <div id="redeemMsg" class="small" style="margin-top:8px"></div>
      <div class="card" style="margin-top:12px">
        <div class="small">·∫¢nh trang nh·∫≠p code</div>
        <div id="redeemPreview" class="bg-preview"></div>
      </div>
    </section>

    <!-- WHEEL -->
    <section id="wheelPage" class="card section">
      <h2>V√≤ng quay may m·∫Øn</h2>
      <p class="muted">T·ªâ l·ªá: <b>10%</b> ‚Üí 7k ‚Ä¢ <b>20%</b> ‚Üí 5k ‚Ä¢ <b>40%</b> ‚Üí 2k/3k/4k ‚Ä¢ <b>30%</b> ‚Üí c√¢u chuy·ªán</p>
      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px">
        <div style="flex:1;min-width:300px">
          <div class="wheel-wrap">
            <div class="pointer"></div>
            <div id="wheel" class="wheel" aria-hidden="true"></div>
            <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
              <button id="spinBtn" class="spin-btn">Quay ngay</button>
              <div id="spinInfo" class="small"></div>
            </div>
            <div id="spinResult" class="small" style="margin-top:8px"></div>
          </div>
        </div>
        <div style="width:260px">
          <div class="card">
            <div class="small">VIP Boost</div>
            <div id="vipFlag" class="muted-note" style="margin-top:8px"></div>
          </div>
          <div class="card" style="margin-top:12px">
            <div class="small">·∫¢nh v√≤ng quay</div>
            <div id="wheelPreview" class="bg-preview"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- HISTORY -->
    <section id="historyPage" class="card section">
      <h2>L·ªãch s·ª≠</h2>
      <p class="muted">L·ªãch s·ª≠ g·∫Øn v·ªõi t√†i kho·∫£n (l∆∞u local).</p>
      <div id="historyList" class="history-list" style="margin-top:10px">Ch∆∞a c√≥ l·ªãch s·ª≠</div>
    </section>

    <!-- ACCOUNT -->
    <section id="accountPage" class="card section">
      <h2>T√†i kho·∫£n</h2>
      <div id="accountBox">
        <div class="small">B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p</div>
        <div style="margin-top:12px"><button id="openAuth" class="btn-primary">ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</button></div>
      </div>
      <div style="margin-top:12px" class="card">
        <div class="small">Upload ·∫£nh (d√πng cho trang)</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input type="file" id="uploadHome" accept="image/*">
          <input type="file" id="uploadRedeem" accept="image/*">
          <input type="file" id="uploadWheel" accept="image/*">
        </div>
        <div class="muted-note" style="margin-top:8px">Upload ·∫£nh s·∫Ω l∆∞u v√†o localStorage cho tr√¨nh duy·ªát n√†y.</div>
      </div>
    </section>

  </div>

  <!-- RIGHT column (quick controls) -->
  <aside class="right-col">
    <div class="card">
      <div class="small">Nh·∫°c n·ªÅn (LoFi)</div>
      <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
        <button id="playMusic" class="btn-primary">B·∫≠t nh·∫°c</button>
        <button id="muteMusic" class="btn">T·∫Øt nh·∫°c</button>
      </div>
      <div class="small" style="margin-top:8px">B·∫°n c√≥ th·ªÉ t·∫Øt/h·ªßy nh·∫°c ho·∫∑c thay link MP3 trong m√£.</div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="small">Nh·∫≠p code nhanh</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="sideCode" placeholder="NH·∫¨P CODE">
        <button id="sideApply" class="btn-primary">OK</button>
      </div>
      <div id="sideMsg" class="small" style="margin-top:8px"></div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="small">Mini l·ªãch s·ª≠</div>
      <div id="miniHistory" class="history-list small" style="margin-top:8px">Ch∆∞a c√≥</div>
    </div>
  </aside>
</main>

<!-- Bottom navigation -->
<div class="bottom-nav" id="bottomNav">
  <div class="nav-item active" data-target="homePage"><div class="icon">üè†</div><div class="small">Home</div></div>
  <div class="nav-item" data-target="redeemPage"><div class="icon">üì•</div><div class="small">Nh·∫≠p m√£</div></div>
  <div class="nav-item" data-target="wheelPage"><div class="icon">üé°</div><div class="small">Quay</div></div>
  <div class="nav-item" data-target="historyPage"><div class="icon">üìú</div><div class="small">L·ªãch s·ª≠</div></div>
  <div class="nav-item" data-target="accountPage" id="navAccount"><div class="icon">üë§</div><div class="small">T√†i kho·∫£n</div></div>
</div>

<!-- modals, loading -->
<div id="modalRoot"></div>
<div id="transitionLoader" class="loading-overlay"><div class="loader">ƒêang t·∫£i...</div></div>

<!-- audio (LoFi from Pixabay - free) -->
<audio id="bgMusic" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_7b65e8c3f2.mp3?filename=lofi-chill-11293.mp3" type="audio/mpeg">
</audio>

<script>
/* ============================
   Data model + session
   ============================ */
const KEY = 'phongcard_full_v1';
let DB = JSON.parse(localStorage.getItem(KEY) || '{}');
if (!DB.users) DB.users = {};           // users[user] = {pass,spins,balance,vipBoost,history:[]}
if (!DB.usedCodes) DB.usedCodes = [];   // used global codes
if (!DB.images) DB.images = {};         // images: home, redeem, wheel (data URLs)
if (!DB._seeded) {
  // seed 30 sample PHONGCARD001..030 and a couple VIP/GIFT for test
  for (let i=1;i<=30;i++){ DB['PHONGCARD' + String(i).padStart(3,'0')] = {type:'card'}; }
  DB['PHONGVIP001'] = {type:'vip'}; DB['PHONGGIFT001'] = {type:'gift'};
  DB._seeded = true;
  localStorage.setItem(KEY, JSON.stringify(DB));
}
function saveDB(){ localStorage.setItem(KEY, JSON.stringify(DB)); }

/* session */
let current = localStorage.getItem(KEY + '_session') || null;
if (current && !DB.users[current]) { current = null; localStorage.removeItem(KEY + '_session'); }

/* UI refs */
const sections = document.querySelectorAll('.section');
const navItems = document.querySelectorAll('.nav-item');
const transitionLoader = document.getElementById('transitionLoader');
const homePreview = document.getElementById('homePreview');
const redeemPreview = document.getElementById('redeemPreview');
const wheelPreview = document.getElementById('wheelPreview');

const userBlock = document.getElementById('userBlock');
const spinsBlock = document.getElementById('spinsBlock');
const balBlock = document.getElementById('balBlock');

const codeInput = document.getElementById('codeInput');
const applyCodeBtn = document.getElementById('applyCode');
const redeemMsg = document.getElementById('redeemMsg');

const sideCode = document.getElementById('sideCode');
const sideApply = document.getElementById('sideApply');
const sideMsg = document.getElementById('sideMsg');

const historyList = document.getElementById('historyList');
const miniHistory = document.getElementById('miniHistory');

const spinBtn = document.getElementById('spinBtn');
const wheelEl = document.getElementById('wheel');
const spinInfo = document.getElementById('spinInfo');
const spinResult = document.getElementById('spinResult');
const vipFlag = document.getElementById('vipFlag');

/* audio */
const bgMusic = document.getElementById('bgMusic');
const playMusicBtn = document.getElementById('playMusic');
const muteMusicBtn = document.getElementById('muteMusic');
const musicBtnTop = document.getElementById('musicBtn');

/* uploads */
const uploadHome = document.getElementById('uploadHome');
const uploadRedeem = document.getElementById('uploadRedeem');
const uploadWheel = document.getElementById('uploadWheel');
const imgUploadBtn = document.getElementById('imgUploadBtn');

/* auth */
const openAuthBtn = document.getElementById('openAuth');
const accountBox = document.getElementById('accountBox');

/* bottom nav clicks */
navItems.forEach(it => {
  it.addEventListener('click', ()=> {
    const tgt = it.dataset.target;
    if (!tgt) return;
    navItems.forEach(n=>n.classList.remove('active'));
    it.classList.add('active');
    navigateTo(tgt);
  });
});

/* initial: attach small handlers */
document.getElementById('openAuth').addEventListener('click', openAuth);
document.getElementById('imgUploadBtn').addEventListener('click', ()=> {
  document.getElementById('uploadHome').click();
});
playMusicBtn.addEventListener('click', ()=> { bgMusic.play(); toast('Nh·∫°c ƒëang ph√°t'); updateMusicButtons(); });
muteMusicBtn.addEventListener('click', ()=> { bgMusic.pause(); toast('Nh·∫°c t·∫Øt'); updateMusicButtons(); });
musicBtnTop.addEventListener('click', ()=> { if (bgMusic.paused) { bgMusic.play(); toast('Nh·∫°c ƒëang ph√°t') } else { bgMusic.pause(); toast('Nh·∫°c t·∫Øt') } updateMusicButtons(); });

applyCodeBtn.addEventListener('click', ()=> handleRedeem(codeInput.value));
sideApply.addEventListener('click', ()=> handleRedeem(sideCode.value));

uploadHome.addEventListener('change', (e)=> handleUpload(e, 'home'));
uploadRedeem.addEventListener('change', (e)=> handleUpload(e, 'redeem'));
uploadWheel.addEventListener('change', (e)=> handleUpload(e, 'wheel'));

/* sample music auto-config */
let userWantsAutoplay = false;
bgMusic.volume = 0.45;

/* ===========================
   Helpers: navigation + transitions
   =========================== */
function showTransition(ms=420){
  transitionLoader.classList.add('show');
  return new Promise(res => setTimeout(()=>{ transitionLoader.classList.remove('show'); res(); }, ms));
}
async function navigateTo(sectionId){
  await showTransition(380);
  sections.forEach(s=> s.classList.remove('active'));
  document.getElementById(sectionId).classList.add('active');
  // if redeem focus input
  if (sectionId === 'redeemPage') { setTimeout(()=> codeInput.focus(), 200); }
  // if wheel ensure wheel render
  if (sectionId === 'wheelPage'){ renderWheel(); }
  // update UI
  renderAll();
}

/* ===========================
   Auth: register/login/logout
   =========================== */
function openAuth(){
  const modal = document.createElement('div'); modal.className='modal-back';
  modal.innerHTML = `<div class="modal">
    <h3>ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</h3>
    <input id="authUser" placeholder="T√™n t√†i kho·∫£n (kh√¥ng d·∫•u)">
    <input id="authPass" placeholder="M·∫≠t kh·∫©u" type="password">
    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="btnDoLogin" class="btn-primary">ƒêƒÉng nh·∫≠p</button>
      <button id="btnDoReg" class="btn">ƒêƒÉng k√Ω</button>
      <button id="btnClose" class="btn">ƒê√≥ng</button>
    </div>
    <div class="muted-note" style="margin-top:10px">D·ªØ li·ªáu l∆∞u c·ª•c b·ªô (LocalStorage).</div>
  </div>`;
  document.getElementById('modalRoot').appendChild(modal);
  document.getElementById('btnClose').onclick = ()=> modal.remove();
  document.getElementById('btnDoReg').onclick = ()=> {
    const u = (document.getElementById('authUser').value||'').trim();
    const p = (document.getElementById('authPass').value||'').trim();
    if (!u || !p) return alert('Nh·∫≠p t√™n & m·∫≠t kh·∫©u!');
    if (DB.users[u]) return alert('T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!');
    DB.users[u] = { pass:p, spins:0, balance:0, vipBoost:false, history:[] };
    saveDB();
    current = u; localStorage.setItem(KEY + '_session', current); modal.remove(); toast('ƒêƒÉng k√Ω & ƒëƒÉng nh·∫≠p: '+u); renderAll();
    // after login go home
    navigateTo('homePage');
  };
  document.getElementById('btnDoLogin').onclick = ()=> {
    const u = (document.getElementById('authUser').value||'').trim();
    const p = (document.getElementById('authPass').value||'').trim();
    if (!DB.users[u] || DB.users[u].pass !== p) return alert('Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!');
    current = u; localStorage.setItem(KEY + '_session', current); modal.remove(); toast('ƒêƒÉng nh·∫≠p: '+u); renderAll(); navigateTo('homePage');
  };
}

function openAccountModal(){
  if (!current) return openAuth();
  const m = document.createElement('div'); m.className='modal-back';
  const U = DB.users[current];
  m.innerHTML = `<div class="modal">
    <h3>T√†i kho·∫£n: ${current}</h3>
    <div class="small">S·ªë d∆∞: ${(U.balance||0).toLocaleString()} VND</div>
    <div class="small">L∆∞·ª£t quay: ${(U.spins||0)}</div>
    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="btnLogout" class="btn">ƒêƒÉng xu·∫•t</button>
      <button id="btnExport" class="btn">Export</button>
      <button id="btnClose2" class="btn">ƒê√≥ng</button>
    </div>
  </div>`;
  document.getElementById('modalRoot').appendChild(m);
  document.getElementById('btnClose2').onclick = ()=> m.remov
