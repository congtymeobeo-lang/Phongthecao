<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PhongCard ‚Äî Si√™u c·∫•p tinh x·∫£o</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#061021; --card:#0f1a2a; --glass:rgba(255,255,255,0.03);
    --muted:#9fb3c8; --accent1:#60a5fa; --accent2:#6ee7b7; --accent3:#a78bfa;
    --success:#10b981; --danger:#fb7185;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#e6f2fb;background:
    radial-gradient(800px 400px at 10% 10%, rgba(96,165,250,0.04), transparent 10%),
    radial-gradient(600px 300px at 90% 90%, rgba(110,231,183,0.03), transparent 10%),
    var(--bg); -webkit-font-smoothing:antialiased}
  /* header */
  header{height:72px;display:flex;align-items:center;gap:12px;padding:0 18px;border-bottom:1px solid rgba(255,255,255,0.02);backdrop-filter: blur(6px)}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:48px;height:48;border-radius:10px;background:linear-gradient(135deg,var(--accent2),var(--accent3));display:flex;align-items:center;justify-content:center;font-weight:800;color:#05202a}
  .site-title{font-size:18px;margin:0}
  .site-sub{font-size:12px;color:var(--muted);margin-top:2px}
  .sp{flex:1}
  nav{display:flex;gap:8px;align-items:center}
  .btn{padding:8px 12px;border-radius:10px;border:0;background:transparent;color:var(--muted);cursor:pointer}
  .btn:hover{color:#fff}
  .btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#022; font-weight:700;padding:8px 14px;border-radius:10px;cursor:pointer}
  .hamb{display:none}
  @media(max-width:980px){ .hide-sm{display:none} .hamb{display:block} }
  /* layout */
  .container{max-width:1100px;margin:22px auto;padding:12px;display:grid;grid-template-columns:1fr 380px;gap:18px}
  @media(max-width:980px){ .container{grid-template-columns:1fr;padding:12px 14px} }
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:18px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 8px 30px rgba(2,6,23,0.55)}
  h2{margin:0 0 10px 0}
  p.muted{color:var(--muted);margin:6px 0 12px 0}
  input, select, textarea{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;margin-top:8px}
  .row{display:flex;gap:10px}
  .small{font-size:13px;color:var(--muted)}
  /* wheel */
  .wheel-wrap{display:flex;flex-direction:column;align-items:center;gap:12px}
  .wheel{width:320px;height:320px;border-radius:50%;position:relative;overflow:hidden;border:8px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;transition:transform 4s cubic-bezier(.2,.9,.2,1)}
  .pointer{position:relative;top:-18px;width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:28px solid var(--accent2);z-index:4}
  .slice{position:absolute;width:50%;height:50%;left:50%;top:50%;transform-origin:0 0;display:flex;align-items:center;justify-content:center;font-weight:700}
  .spin-btn{padding:12px 18px;border-radius:12px;border:0;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#022;font-weight:800;cursor:pointer;box-shadow:0 8px 20px rgba(96,165,250,0.12)}
  /* list */
  .history-list{max-height:340px;overflow:auto;padding:8px;background:rgba(0,0,0,0.10);border-radius:10px}
  .history-item{padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);margin-bottom:8px}
  /* shop intro */
  .hero{display:flex;gap:18px;align-items:center}
  .hero .left{flex:1}
  .hero .cover{width:140px;height:110px;border-radius:12px;background:linear-gradient(135deg,var(--accent3),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#022;font-size:18px}
  /* footer small */
  footer{max-width:1100px;margin:18px auto;color:var(--muted);font-size:13px;text-align:center}
  /* modal */
  .modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:80}
  .modal{width:420px;max-width:94%;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;border:1px solid rgba(255,255,255,0.03)}
  .flex{display:flex;gap:8px}
  /* micro */
  .chip{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-weight:700}
  .ok{color:var(--success)} .bad{color:var(--danger)}
  .fade{animation:fadeIn .28s ease}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">P</div>
    <div>
      <div class="site-title">PhongCard</div>
      <div class="site-sub">Shop giftcode ‚Äî Quay th∆∞·ªüng ‚Äî Tinh x·∫£o</div>
    </div>
  </div>
  <div class="sp"></div>
  <nav>
    <button class="btn hide-sm" id="navHome">Trang ch·ªß</button>
    <button class="btn hide-sm" id="navRedeem">Nh·∫≠p giftcode</button>
    <button class="btn hide-sm" id="navWheel">V√≤ng quay</button>
    <button class="btn hide-sm" id="navHistory">L·ªãch s·ª≠</button>
    <button class="btn-primary" id="btnAuth">ƒêƒÉng nh·∫≠p</button>
    <button class="hamb" id="hambBtn">‚ò∞</button>
  </nav>
</header>

<main class="container">
  <!-- left: dashboard -->
  <section id="home" class="card fade">
    <div class="hero">
      <div class="left">
        <h2>Ch√†o m·ª´ng ƒë·∫øn PhongCard ‚Äî Shop giftcode tinh x·∫£o</h2>
        <p class="muted">Trang n√†y l√† shop gi·∫£ l·∫≠p: dashboard s·∫°ch (kh√¥ng show code). ƒêƒÉng nh·∫≠p ƒë·ªÉ nh·∫≠p giftcode b·∫°n c√≥ v√† quay th∆∞·ªüng. D·ªØ li·ªáu l∆∞u tr√™n tr√¨nh duy·ªát c·ªßa b·∫°n (LocalStorage).</p>
        <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap">
          <div class="card" style="min-width:180px">
            <div class="small">T√†i kho·∫£n</div>
            <div id="userInfo" style="font-weight:700;margin-top:8px">Ch∆∞a ƒëƒÉng nh·∫≠p</div>
          </div>
          <div class="card" style="min-width:180px">
            <div class="small">L∆∞·ª£t quay</div>
            <div id="spinCount" style="font-weight:800;font-size:18px;margin-top:8px">0</div>
          </div>
        </div>
      </div>
      <div class="cover">SHOP</div>
    </div>

    <hr style="opacity:0.06;margin:16px 0">

    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px">
      <div class="card">
        <h3>Gi·ªõi thi·ªáu</h3>
        <p class="small">PhongCard b√°n giftcode/khuy·∫øn m√£i. Giao di·ªán hi·ªán ƒë·∫°i, v·∫≠n h√†nh m∆∞·ª£t. M·ªói giftcode c√≥ th·ªÉ l√†: PHONGCARD (l∆∞·ª£t quay), PHONGVIP (bonus), PHONGGIFT (ti·ªÅn tr·ª±c ti·∫øp).</p>
      </div>
      <div class="card">
        <h3>T·ª∑ l·ªá v√≤ng quay</h3>
        <p class="small">K·∫øt qu·∫£ quay theo t·ª∑ l·ªá b·∫°n ƒë·∫∑t:</p>
        <ul class="small">
          <li><b>10%</b> ‚Üí 7,000 VND</li>
          <li><b>20%</b> ‚Üí 5,000 VND</li>
          <li><b>40%</b> ‚Üí C√°c m·ªánh gi√° kh√°c: 2,000 / 3,000 / 4,000</li>
          <li><b>30%</b> ‚Üí C√¢u chuy·ªán (random)</li>
        </ul>
      </div>
      <div class="card">
        <h3>Ghi ch√∫</h3>
        <p class="small">Dashboard kh√¥ng hi·ªÉn th·ªã m√£. B·∫°n c√≥ th·ªÉ ph√°t code ri√™ng, g·ª≠i cho kh√°ch. M·ªói code ch·ªâ d√πng 1 l·∫ßn.</p>
      </div>
    </div>
  </section>

  <!-- right column: controls -->
  <aside>
    <div class="card fade" style="margin-bottom:12px">
      <div class="small">Nh·∫≠p giftcode</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="inputCode" placeholder="Nh·∫≠p code (v√≠ d·ª• PHONGCARD001)">
        <button class="btn-primary" id="btnRedeem">Nh·∫≠n code</button>
      </div>
      <div id="redeemMsg" class="small" style="margin-top:8px"></div>
    </div>

    <div class="card fade">
      <div class="small">V√≤ng quay may m·∫Øn</div>
      <div class="wheel-wrap" style="margin-top:12px">
        <div class="pointer"></div>
        <div id="wheel" class="wheel" aria-hidden="true"></div>
        <div style="display:flex;gap:8px;margin-top:12px;justify-content:center">
          <button class="spin-btn" id="btnSpin">Quay ngay</button>
        </div>
        <div id="spinResult" class="small" style="margin-top:10px"></div>
      </div>
    </div>

    <div class="card fade" style="margin-top:12px">
      <div class="small">L·ªãch s·ª≠ g·∫ßn ƒë√¢y</div>
      <div id="history" class="history-list" style="margin-top:10px">Ch∆∞a c√≥ l·ªãch s·ª≠</div>
    </div>
  </aside>
</main>

<footer>Phi√™n b·∫£n demo ‚Äî D·ªØ li·ªáu l∆∞u tr√™n tr√¨nh duy·ªát. Mu·ªën l∆∞u server-side th√¨ m√¨nh t√≠ch h·ª£p Firebase.</footer>

<!-- AUTH / MESSAGES MODAL (hidden) -->
<div id="modalRoot" style="display:none"></div>

<script>
/* =========================
   DATA MODEL (LocalStorage)
   ========================= */
const KEY = 'phongcard_v2';
let DB = JSON.parse(localStorage.getItem(KEY) || '{}');
if (!DB.users) DB.users = {};       // { username: { pass, spins, history:[], vipBoost:false } }
if (!DB.usedCodes) DB.usedCodes = []; // global used codes
if (!DB.stories) DB.stories = [
  "C√¢u chuy·ªán: Phong v√† chuy·∫øn h√†nh tr√¨nh xuy√™n ƒë√™m...",
  "C√¢u chuy·ªán: M·ªôt l·∫ßn v√†o server l·∫°, Phong t√¨m th·∫•y kho b√°u...",
  "C√¢u chuy·ªán: L·ªùi nh·∫Øn b√≠ m·∫≠t trong th·∫ª c√†o..."
];
saveDB();

// session
let current = localStorage.getItem(KEY + '_session') || null;

/* -------------------
   UTILS
   ------------------- */
function saveDB(){ localStorage.setItem(KEY, JSON.stringify(DB)); }
function saveSession(){ if (current) localStorage.setItem(KEY + '_session', current); else localStorage.removeItem(KEY + '_session'); }

/* -------------------
   UI refs
   ------------------- */
const userInfo = document.getElementById('userInfo');
const spinCountEl = document.getElementById('spinCount');
const inputCode = document.getElementById('inputCode');
const redeemMsg = document.getElementById('redeemMsg');
const historyEl = document.getElementById('history');
const wheelEl = document.getElementById('wheel');
const spinResult = document.getElementById('spinResult');

/* -------------------
   INITIAL RENDER
   ------------------- */
renderUser();
renderHistory();
renderWheel();

/* ====================
   NAV / AUTH
   ==================== */
document.getElementById('btnAuth').addEventListener('click', openAuth);
document.getElementById('navHome').addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));
document.getElementById('navRedeem').addEventListener('click', ()=>inputCode.focus());
document.getElementById('navWheel').addEventListener('click', ()=>wheelEl.scrollIntoView({behavior:'smooth'}));
document.getElementById('navHistory').addEventListener('click', ()=>historyEl.scrollIntoView({behavior:'smooth'}));
document.getElementById('hambBtn').addEventListener('click', ()=> {
  const choice = prompt("Menu: 1=Trang ch·ªß, 2=Nh·∫≠p code, 3=V√≤ng quay, 4=L·ªãch s·ª≠, 5=ƒêƒÉng nh·∫≠p/ƒêK. Nh·∫≠p s·ªë:");
  if (!choice) return;
  if (choice==='1') window.scrollTo({top:0,behavior:'smooth'});
  if (choice==='2') inputCode.focus();
  if (choice==='3') wheelEl.scrollIntoView({behavior:'smooth'});
  if (choice==='4') historyEl.scrollIntoView({behavior:'smooth'});
  if (choice==='5') openAuth();
});

/* ====================
   GIFT CODE LOGIC
   ==================== */
/*
 Three types (format examples):
  - PHONGCARD###  => +1 spin
  - PHONGVIP###   => +2 spins + vipBoost true (one-time boost)
  - PHONGGIFT###  => direct money reward (2k-7k)
 Each code one-time global (DB.usedCodes)
*/
function normalizeCode(s){ return (s||'').trim().toUpperCase(); }

document.getElementById('btnRedeem').addEventListener('click', ()=> {
  const raw = normalizeCode(inputCode.value);
  if (!current) return showTemp(redeemMsg, "Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc!", true);
  if (!raw) return showTemp(redeemMsg, "Nh·∫≠p code ƒë√£ nh√©", true);
  if (DB.usedCodes.includes(raw)) return showTemp(redeemMsg, "Code ƒë√£ ƒë∆∞·ª£c d√πng", true);

  // validation patterns
  if (/^PHONGCARD\d{1,6}$/.test(raw)) {
    // +1 spin
    DB.usedCodes.push(raw);
    DB.users[current].spins = (DB.users[current].spins||0) + 1;
    saveDB(); renderUser(); showTemp(redeemMsg, "Nh·∫≠n 1 l∆∞·ª£t quay! Ch√∫c b·∫°n may m·∫Øn üéâ");
    inputCode.value='';
    return;
  }
  if (/^PHONGVIP\d{1,6}$/.test(raw)) {
    DB.usedCodes.push(raw);
    DB.users[current].spins = (DB.users[current].spins||0) + 2;
    DB.users[current].vipBoost = true; // next spin will get boosted (we'll apply by slightly increasing chance of higher rewards)
    saveDB(); renderUser(); showTemp(redeemMsg, "PHONGVIP: +2 l∆∞·ª£t & 1 VIP boost cho l·∫ßn quay ti·∫øp theo! üöÄ");
    inputCode.value='';
    return;
  }
  if (/^PHONGGIFT\d{1,6}$/.test(raw)) {
    DB.usedCodes.push(raw);
    // direct money 2k-7k random
    const values = [2000,3000,4000,5000,7000];
    const money = values[Math.floor(Math.random()*values.length)];
    const rec = { prize: `${money.toLocaleString()} VND (Giftcode)`, time: new Date().toLocaleString() };
    DB.users[current].history = DB.users[current].history || [];
    DB.users[current].history.unshift(rec);
    saveDB(); renderHistory(); showTemp(redeemMsg, `B·∫°n nh·∫≠n ${money.toLocaleString()} VND t·ª´ PHONGGIFT üéâ`);
    inputCode.value='';
    return;
  }
  showTemp(redeemMsg, "Code kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë·ªãnh d·∫°ng kh√¥ng ƒë√∫ng.", true);
});

/* ====================
   WHEEL (probabilities)
   ====================
   We implement weighted random so final distribution approximates:
   - 10% -> 7k
   - 20% -> 5k
   - 40% -> other m·ªánh gi√° (split among 2k,3k,4k)
   - 30% -> story
   VIP boost slightly increases chance for 7k and 5k for next spin
*/
const PRIZE_BUCKETS = [
  {id:'7k', label:'7,000 VND', weight:10, type:'money', value:7000},
  {id:'5k', label:'5,000 VND', weight:20, type:'money', value:5000},
  // split 40% into three items (approx)
  {id:'4k', label:'4,000 VND', weight:14, type:'money', value:4000},
  {id:'3k', label:'3,000 VND', weight:13, type:'money', value:3000},
  {id:'2k', label:'2,000 VND', weight:13, type:'money', value:2000},
  {id:'story', label:'C√¢u chuy·ªán b√≠ ·∫©n', weight:30, type:'story', value:0}
];

function weightedPick(boost=false){
  // If boost true (for PHONGVIP), increase high-tier weights slightly
  const items = PRIZE_BUCKETS.map(it=>{
    const w = boost && it.id==='7k' ? it.weight + 6 : boost && it.id==='5k' ? it.weight + 4 : it.weight;
    return {...it, weight:w};
  });
  const total = items.reduce((s,it)=>s+it.weight,0);
  let r = Math.random()*total;
  for (let it of items){
    if (r < it.weight) return it;
    r -= it.weight;
  }
  return items[items.length-1];
}

/* Render wheel visuals (slices) */
function renderWheel(){
  wheelEl.innerHTML = '';
  const slices = PRIZE_BUCKETS;
  const n = slices.length;
  const colors = ['#065f46','#0ea5a4','#0284c7','#7c3aed','#d946ef','#f59e0b'];
  for (let i=0;i<n;i++){
    const s = document.createElement('div');
    s.className = 'slice';
    const angle = 360/n * i;
    s.style.transform = `rotate(${angle}deg) translate(-50%,-50%)`;
    s.style.width = '60%';
    s.style.height = '60%';
    s.style.left = '50%';
    s.style.top = '50%';
    s.style.background = colors[i % colors.length];
    s.style.clipPath = 'polygon(0 0, 100% 0, 0 100%)';
    s.style.display = 'flex';
    s.style.alignItems = 'center';
    s.style.justifyContent = 'flex-start';
    s.style.paddingLeft = '28%';
    s.style.color = '#022';
    s.style.fontWeight = '800';
    // rotate label so it's readable
    const label = document.createElement('div');
    label.style.transform = `rotate(${90 + (360/n)*0.5}deg)`;
    label.innerText = slices[i].label;
    s.appendChild(label);
    wheelEl.appendChild(s);
  }
}

/* handle spin animation + pick based on weights */
let spinning = false;
document.getElementById('btnSpin').addEventListener('click', async ()=>{
  if (!current) return alert('ƒêƒÉng nh·∫≠p ƒë·ªÉ quay!');
  if (!DB.users[current] || (DB.users[current].spins||0) <= 0) return alert('B·∫°n ch∆∞a c√≥ l∆∞·ª£t quay. Nh·∫≠p giftcode ƒë·ªÉ l·∫•y l∆∞·ª£t!');
  if (spinning) return;
  spinning = true;
  spinResult.innerText = 'ƒêang quay...';
  // apply VIP boost if present, and flip vipBoost flag after applying
  const boost = DB.users[current].vipBoost === true;
  if (boost) DB.users[current].vipBoost = false;
  // pick prize index based on weightedPick
  const chosen = weightedPick(boost);
  // compute target rotation
  const idx = PRIZE_BUCKETS.findIndex(p=>p.id===chosen.id);
  const single = 360 / PRIZE_BUCKETS.length;
  // random full rotations + land on chosen slice center
  const rotations = 4 + Math.floor(Math.random()*3); // 4..6
  const targetDeg = rotations*360 + idx*single + single/2 + (Math.random()*single - single/2);
  wheelEl.style.transition = 'transform 4s cubic-bezier(.2,.9,.2,1)';
  wheelEl.style.transform = `rotate(${targetDeg}deg)`;
  // consume spin immediately
  DB.users[current].spins = Math.max(0, (DB.users[current].spins||0) - 1);
  saveDB(); renderUser();
  // after animation finalize
  setTimeout(()=>{
    // normalize rotation to finalDeg for visual continuity
    const finalDeg = targetDeg % 360;
    wheelEl.style.transition = '';
    wheelEl.style.transform = `rotate(${finalDeg}deg)`;
    // award prize
    let prizeText = '';
    if (chosen.type === 'money') {
      prizeText = `${chosen.value.toLocaleString()} VND`;
      DB.users[current].balance = (DB.users[current].balance || 0) + chosen.value;
    } else if (chosen.type === 'story') {
      const s = DB.stories[Math.floor(Math.random()*DB.stories.length)];
      prizeText = s;
    }
    const rec = { prize: prizeText, type: chosen.type, value: chosen.type==='money'?chosen.value:0, time: new Date().toLocaleString() };
    DB.users[current].history = DB.users[current].history || [];
    DB.users[current].history.unshift(rec);
    saveDB();
    renderUser();
    renderHistory();
    spinResult.innerText = `üéâ B·∫°n nh·∫≠n: ${prizeText}`;
    spinning = false;
  }, 4200);
});

/* ====================
   HISTORY & UI render
   ==================== */
function renderHistory(){
  historyEl.innerHTML = '';
  if (!current || !DB.users[current] || !DB.users[current].history || DB.users[current].history.length===0){
    historyEl.innerHTML = '<div class="small">Ch∆∞a c√≥ l·ªãch s·ª≠ ‚Äî quay xong s·∫Ω l∆∞u ·ªü ƒë√¢y.</div>'; return;
  }
  DB.users[current].history.slice(0,40).forEach(h=>{
    const div = document.createElement('div');
    div.className = 'history-item';
    div.innerHTML = `<div style="font-weight:700">${h.prize}</div><div class="small" style="margin-top:6px">${h.time}</div>`;
    historyEl.appendChild(div);
  });
}

/* render user block */
function renderUser(){
  if (current && DB.users[current]) {
    userInfo.innerHTML = `${current} <div class="small" style="margin-top:6px">S·ªë d∆∞: ${ (DB.users[current].balance||0).toLocaleString() } VND</div>`;
    spinCountEl.innerText = (DB.users[current].spins||0);
    document.getElementById('btnAuth').innerText = 'T√†i kho·∫£n';
    document.getElementById('btnAuth').onclick = openAccountMenu;
  } else {
    userInfo.innerHTML = 'Ch∆∞a ƒëƒÉng nh·∫≠p';
    spinCountEl.innerText = '0';
    document.getElementById('btnAuth').innerText = 'ƒêƒÉng nh·∫≠p';
    document.getElementById('btnAuth').onclick = openAuth;
  }
}

/* quick show message then clear */
function showTemp(el, text, isErr=false){
  el.innerText = text; el.style.color = isErr? 'var(--danger)':'var(--accent2)';
  setTimeout(()=>{ if (el) { el.innerText=''; el.style.color=''; } }, 5000);
}

/* AUTH modal / flow */
function openAuth(){
  const m = document.createElement('div'); m.className='modal-back';
  m.innerHTML = `<div class="modal fade">
    <h3>ƒêƒÉng nh·∫≠p ho·∫∑c ƒêƒÉng k√Ω</h3>
    <div style="margin-top:8px">
      <input id="authUser" placeholder="T√™n t√†i kho·∫£n (kh√¥ng d·∫•u)"><input id="authPass" placeholder="M·∫≠t kh·∫©u" style="margin-top:8px">
      <div style="display:flex;gap:8px;margin-top:12px">
        <button id="doLogin" class="btn-primary">ƒêƒÉng nh= ''; 
  db.codes.slice(0,30).forEach(c=>{
    const b = document.createElement('div');
    b.style.padding='6px 8px';
    b.style.borderRadius='8px';
    b.style.background='linear-gradient(180deg, rgba(255,255,255,0.01), transparent)';
    b.style.border='1px solid rgba(255,255,255,0.02)';
    b.style.cursor='pointer';
    b.style.fontSize='13px';
    b.innerText = c;
    b.addEventListener('click', ()=> { giftInput.value = c; });
    container.appendChild(b);
  });
}

function renderUserState(){
  if (currentUser && db.users[currentUser]) {
    userBox.innerHTML = `<div style="font-weight:700">${currentUser}</div><div class="small">ƒêƒÉng nh·∫≠p</div>`;
    spinCount.innerText = db.users[currentUser].spins || 0;
  } else {
    userBox.innerHTML = `<div class="small">Ch∆∞a ƒëƒÉng nh·∫≠p</div><div style="margin-top:8px"><button class="btn-primary" onclick="openAuthModal()">ƒêƒÉng nh·∫≠p / ƒêK</button></div>`;
    spinCount.innerText = '0';
  }
}

function openAuthModal(){
  // simple prompt modal -> register/login flows
  const action = prompt("Ch·ªçn: 1 = ƒêƒÉng k√Ω m·ªõi, 2 = ƒêƒÉng nh·∫≠p, 3 = ƒêƒÉng xu·∫•t (n·∫øu ƒëang ƒëƒÉng nh·∫≠p)\nNh·∫≠p 1/2/3:");
  if (!action) return;
  if (action === '1') {
    const u = prompt("T√™n t√†i kho·∫£n (kh√¥ng d·∫•u, vi·∫øt li·ªÅn):");
    if (!u) return alert('H·ªßy');
    if (db.users[u]) return alert('T√†i kho·∫£n t·ªìn t·∫°i!');
    const p = prompt("M·∫≠t kh·∫©u:");
    if (!p) return alert('H·ªßy');
    db.users[u] = { pass: p, spins: 0, history: [], usedCodes: [] };
    save();
    alert('ƒêƒÉng k√Ω th√†nh c√¥ng! B·∫•m OK ƒë·ªÉ ƒëƒÉng nh·∫≠p.');
    currentUser = u; saveSession(); renderUserState(); renderHistory();
  } else if (action === '2') {
    const u = prompt("T√™n t√†i kho·∫£n:");
    if (!u) return;
    const p = prompt("M·∫≠t kh·∫©u:");
    if (!p) return;
    if (!db.users[u] || db.users[u].pass !== p) return alert('Sai th√¥ng tin!');
    currentUser = u; saveSession(); renderUserState(); renderHistory();
    alert('ƒêƒÉng nh·∫≠p th√†nh c√¥ng: ' + u);
  } else if (action === '3') {
    if (!currentUser) return alert('B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p');
    if (!confirm('B·∫°n mu·ªën ƒëƒÉng xu·∫•t?')) return;
    currentUser = null; saveSession(); renderUserState(); renderHistory();
    alert('ƒê√£ ƒëƒÉng xu·∫•t');
  } else alert('Kh√¥ng h·ª£p l·ªá');
}

/* Redeem code logic */
function redeemCode(){
  if (!currentUser || !db.users[currentUser]) return alert('H√£y ƒëƒÉng nh·∫≠p tr∆∞·ªõc!');
  const code = (giftInput.value || '').trim().toUpperCase();
  if (!code) return redeemMsg.innerText = 'Nh·∫≠p code ƒë√£ nh√©';
  const idx = db.codes.indexOf(code);
  if (idx === -1) {
    redeemMsg.innerText = '‚ùå Code kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ d√πng';
    return;
  }
  // mark used by user
  db.users[currentUser].spins = (db.users[currentUser].spins || 0) + 1;
  db.users[currentUser].usedCodes = db.users[currentUser].usedCodes || [];
  db.users[currentUser].usedCodes.push(code);
  // remove code globally so can't be reused
  db.codes.splice(idx,1);
  save();
  renderUserState();
  renderSamples();
  redeemMsg.innerText = `‚úÖ Nh·∫≠n 1 l∆∞·ª£t quay! B·∫°n c√≥ ${db.users[currentUser].spins} l∆∞·ª£t.`;
}

/* Wheel rendering + spin */
const wheelPrizes = [
  {type:'money', label:'2,000 VND', value:2000},
  {type:'money', label:'3,000 VND', value:3000},
  {type:'money', label:'5,000 VND', value:5000},
  {type:'money', label:'7,000 VND', value:7000},
  {type:'acc', label:'Acc Blox Fruit', value:0},
  {type:'story', label:'C√¢u chuy·ªán: H√†nh tr√¨nh c·ªßa Phong', value:0}
];

function renderWheel(){
  wheelEl.innerHTML = '';
  const colors = ['#065f46','#0ea5a4','#0284c7','#7c3aed','#d946ef','#f59e0b'];
  const sliceCount = wheelPrizes.length;
  for(let i=0;i<sliceCount;i++){
    const slice = document.createElement('div');
    slice.className = 'slice';
    const angle = 360/sliceCount * i;
    slice.style.transform = `rotate(${angle}deg) translate(-50%, -50%)`;
    slice.style.width = '60%';
    slice.style.height = '60%';
    slice.style.left = '50%';
    slice.style.top = '50%';
    slice.style.background = `conic-gradient(${colors[i % colors.length]} 0 100%)`;
    slice.style.clipPath = 'polygon(0 0, 100% 0, 0 100%)';
    slice.style.display = 'flex';
    slice.style.justifyContent = 'flex-start';
    slice.style.paddingLeft = '30%';
    slice.style.color = '#012';
    slice.style.fontWeight = '700';
    slice.innerHTML = `<div style="transform:rotate(${90 + (360/sliceCount)*0.5}deg);">${wheelPrizes[i].label}</div>`;
    wheelEl.appendChild(slice);
  }
}

/* spin handling */
let spinning = false;
function spinWheel(){
  if (!currentUser || !db.users[currentUser]) return alert('H√£y ƒëƒÉng nh·∫≠p tr∆∞·ªõc!');
  if (spinning) return;
  if ((db.users[currentUser].spins || 0) <= 0) return alert('B·∫°n ch∆∞a c√≥ l∆∞·ª£t quay!');
  spinning = true;
  spinMsg.innerText = 'ƒêang quay...';
  // random pick prize
  const idx = Math.floor(Math.random() * wheelPrizes.length);
  // rotation: full spins + to target segment
  const single = 360 / wheelPrizes.length;
  const target = 360 * (4 + Math.random()*2) + (idx * single) + single/2;
  wheelEl.style.transition = 'transform 4s cubic-bezier(.2,.9,.2,1)';
  wheelEl.style.transform = `rotate(${target}deg)`;
  // reduce spin count
  db.users[currentUser].spins--;
  // after animation
  setTimeout(()=> {
    spinning = false;
    wheelEl.style.transition = '';
    // normalize transform (keep visual but reset rotation modulo 360)
    const finalDeg = target % 360;
    wheelEl.style.transform = `rotate(${finalDeg}deg)`;
    // award prize
    const prize = wheelPrizes[idx];
    let prizeText = '';
    if (prize.type === 'money') {
      prizeText = `Ti·ªÅn ${prize.label}`;
    } else if (prize.type === 'acc') {
      // assign a demo account if available
      const acc = db.accounts.length ? db.accounts.shift() : {name:'AccDemo_Empty', desc:'(H·∫øt acc m·∫´u)'};
      prizeText = `Acc Blox Fruit: ${acc.name} ‚Äî ${acc.desc}`;
    } else if (prize.type === 'story') {
      prizeText = `C√¢u chuy·ªán: H√†nh tr√¨nh c·ªßa Phong (demo)`;
    }
    // record
    db.users[currentUser].history = db.users[currentUser].history || [];
    const rec = { prize: prizeText, time: new Date().toLocaleString() };
    db.users[currentUser].history.unshift(rec);
    save();
    renderUserState();
    renderHistory();
    spinMsg.innerText = `üéâ B·∫°n nh·∫≠n: ${prizeText}`;
  }, 4100);
}

/* history */
function renderHistory(){
  historyBox.innerHTML = '';
  if (!currentUser || !db.users[currentUser]) {
    historyBox.innerHTML = `<div class="small">ƒêƒÉng nh·∫≠p ƒë·ªÉ xem l·ªãch s·ª≠</div>`;
    return;
  }
  const list = db.users[currentUser].history || [];
  if (list.length === 0) {
    historyBox.innerHTML = `<div class="small">Ch∆∞a c√≥ ph·∫ßn th∆∞·ªüng n√†o</div>`;
    return;
  }
  list.slice(0,30).forEach(h=>{
    const div = document.createElement('div');
    div.className = 'history-item';
    div.innerHTML = `<div style="font-weight:700">${h.prize}</div><div class="small" style="margin-top:6px">${h.time}</div>`;
    historyBox.appendChild(div);
  });
}

/* nice helpers */
function scrollToTop(){ window.scrollTo({top:0,behavior:'smooth'}); }
function focusGift(){ document.getElementById('giftInput').focus(); }
function scrollWheel(){ const el = document.querySelector('.wheel-wrap'); if (el) el.scrollIntoView({behavior:'smooth'}); }
function scrollHistory(){ document.querySelector('#historyBox').scrollIntoView({behavior:'smooth'}); }

/* expose some functions for console/test */
window._PHONG = { db, save, current: ()=>currentUser, login: (u,p)=>{ if (db.users[u] && db.users[u].pass===p){ currentUser=u; saveSession(); renderUserState(); renderHistory(); return true } return false } }
</script>
</body>
</html>    <!-- ƒêƒÉng nh·∫≠p -->
    <section id="login" class="card">
      <h2>ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</h2>
      <input type="text" id="username" placeholder="T√™n t√†i kho·∫£n">
      <input type="password" id="password" placeholder="M·∫≠t kh·∫©u (n·∫øu c√≥)">
      <button onclick="login()">X√°c nh·∫≠n</button>
    </section>

    <!-- Nh·∫≠p code -->
    <section id="gift" class="card hidden">
      <h2>Nh·∫≠p Giftcode</h2>
      <input type="text" id="giftcode" placeholder="Nh·∫≠p code...">
      <button onclick="redeemCode()">X√°c nh·∫≠n</button>
      <p id="giftMsg"></p>
    </section>

    <!-- V√≤ng quay -->
    <section id="wheel" class="card hidden">
      <h2>V√≤ng quay may m·∫Øn</h2>
      <div id="wheel">üé°</div>
      <button onclick="spinWheel()">Quay ngay</button>
      <p id="spinMsg"></p>
    </section>

    <!-- L·ªãch s·ª≠ -->
    <section id="history" class="card hidden">
      <h2>L·ªãch s·ª≠ nh·∫≠n th∆∞·ªüng</h2>
      <div id="historyList"></div>
    </section>

    <!-- Admin -->
    <section id="admin" class="card hidden">
      <h2>Admin Dashboard</h2>
      <div id="adminPanel" class="hidden">
        <h3>Danh s√°ch ng∆∞·ªùi ch∆°i</h3>
        <table>
          <thead>
            <tr>
              <th>T√†i kho·∫£n</th>
              <th>L∆∞·ª£t quay</th>
              <th>Code ƒë√£ d√πng</th>
              <th>L·ªãch s·ª≠ th∆∞·ªüng</th>
            </tr>
          </thead>
          <tbody id="userTable"></tbody>
        </table>
      </div>
      <p id="adminMsg"></p>
    </section>
  </main>

  <script>
    // --- Giftcode list (30 code s·∫µn) ---
    const giftcodes = [
      "PHONGCARD001","PHONGCARD002","PHONGCARD003","PHONGCARD004","PHONGCARD005",
      "PHONGCARD006","PHONGCARD007","PHONGCARD008","PHONGCARD009","PHONGCARD010",
      "PHONGCARD011","PHONGCARD012","PHONGCARD013","PHONGCARD014","PHONGCARD015",
      "PHONGCARD016","PHONGCARD017","PHONGCARD018","PHONGCARD019","PHONGCARD020",
      "PHONGCARD021","PHONGCARD022","PHONGCARD023","PHONGCARD024","PHONGCARD025",
      "PHONGCARD026","PHONGCARD027","PHONGCARD028","PHONGCARD029","PHONGCARD030"
    ];

    let currentUser = null;
    let isAdmin = false;
    let data = JSON.parse(localStorage.getItem("giftHub") || "{}");

    function saveData() {
      localStorage.setItem("giftHub", JSON.stringify(data));
    }

    function showPage(id) {
      document.querySelectorAll("main section").forEach(s => s.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      if (id === "history") loadHistory();
      if (id === "admin" && isAdmin) loadAdmin();
    }

    // ƒêƒÉng nh·∫≠p
    function login() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();

      if (!user) return alert("Nh·∫≠p t√™n t√†i kho·∫£n!");

      // admin login
      if (user === "admin" && pass === "phong123") {
        currentUser = "admin";
        isAdmin = true;
        document.getElementById("adminMsg").innerText = "‚úÖ Admin ƒëƒÉng nh·∫≠p th√†nh c√¥ng!";
        document.getElementById("adminPanel").classList.remove("hidden");
        saveData();
        return;
      }

      currentUser = user;
      if (!data[user]) data[user] = { spins:0, history:[], usedCodes:[] };
      isAdmin = false;
      saveData();
      alert("Xin ch√†o, " + user + "!");
    }

    // Redeem code
    function redeemCode() {
      if (!currentUser || isAdmin) return alert("ƒêƒÉng nh·∫≠p b·∫±ng t√†i kho·∫£n th∆∞·ªùng!");
      const code = document.getElementById("giftcode").value.trim().toUpperCase();
      if (!giftcodes.includes(code)) {
        document.getElementById("giftMsg").innerText = "‚ùå Code kh√¥ng h·ª£p l·ªá!";
        return;
      }
      if (data[currentUser].usedCodes.includes(code)) {
        document.getElementById("giftMsg").innerText = "‚ö†Ô∏è Code n√†y ƒë√£ d√πng!";
        return;
      }
      data[currentUser].spins++;
      data[currentUser].usedCodes.push(code);
      saveData();
      document.getElementById("giftMsg").innerText = "‚úÖ Nh·∫≠n th√†nh c√¥ng 1 l∆∞·ª£t quay!";
    }

    // V√≤ng quay
    function spinWheel() {
      if (!currentUser || isAdmin) return alert("ƒêƒÉng nh·∫≠p b·∫±ng t√†i kho·∫£n th∆∞·ªùng!");
      if (data[currentUser].spins <= 0) {
        document.getElementById("spinMsg").innerText = "B·∫°n ch∆∞a c√≥ l∆∞·ª£t quay!";
        return;
      }
      data[currentUser].spins--;

      const prizes = [
        "üíµ 2,000 VND", "üíµ 3,000 VND", "üíµ 5,000 VND", "üíµ 7,000 VND",
        "üéÆ Acc Blox Fruit (Demo)", "üìñ C√¢u chuy·ªán: H√†nh tr√¨nh c·ªßa Phong"
      ];
      const result = prizes[Math.floor(Math.random()*prizes.length)];
      document.getElementById("spinMsg").innerText = "üéâ B·∫°n nh·∫≠n: " + result;
      data[currentUser].history.push({ prize: result, time: new Date().toLocaleString() });
      saveData();
    }

    // L·ªãch s·ª≠
    function loadHistory() {
      if (!currentUser || isAdmin) return;
      const list = document.getElementById("historyList");
      list.innerHTML = "";
      data[currentUser].history.forEach(h => {
        const div = document.createElement("div");
        div.className = "history-item";
        div.innerText = h.time + " ‚Üí " + h.prize;
        list.appendChild(div);
      });
    }

    // Admin dashboard
    function loadAdmin() {
      const table = document.getElementById("userTable");
      table.innerHTML = "";
      for (let user in data) {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${user}</td>
          <td>${data[user].spins}</td>
          <td>${data[user].usedCodes.join(", ") || "Ch∆∞a d√πng"}</td>
          <td>
            ${data[user].history.map(h => h.time + " ‚Üí " + h.prize).join("<br>")}
          </td>
        `;
        table.appendChild(tr);
      }
    }
  </script>
</body>
                </html>
