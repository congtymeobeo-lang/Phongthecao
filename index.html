<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PhongCard Mini Game Nâng Cấp</title>
<style>
/* ===================== Reset & Body ===================== */
* {margin:0; padding:0; box-sizing:border-box;}
body {font-family: Arial, sans-serif; background:#f0f0f0; color:#333; transition: background 0.3s, color 0.3s;}
body.dark {background:#121212; color:#eee;}
a{text-decoration:none; color:inherit;}
button{cursor:pointer;}

/* ===================== Header ===================== */
header{padding:10px; text-align:center; font-size:1.5em; font-weight:bold;}

/* ===================== Menu ===================== */
nav{position:fixed; bottom:0; left:0; width:100%; display:flex; justify-content:space-around; background:#fff; border-top:1px solid #ccc; transition: background 0.3s;}
body.dark nav{background:#1e1e1e; border-top:1px solid #444;}
nav button{flex:1; padding:10px; font-size:1em; border:none; background:none; transition: background 0.3s;}
nav button.active{background:#ddd;}
body.dark nav button.active{background:#333;}

/* ===================== Tabs ===================== */
.tab{display:none; padding:15px; padding-bottom:60px; min-height:80vh;}
.tab.active{display:block;}
h2{margin-bottom:10px;}

/* ===================== Buttons ===================== */
button.action{padding:10px 20px; margin:5px 0; border:none; background:#2196F3; color:#fff; border-radius:5px; transition: transform 0.2s;}
button.action:hover{transform:scale(1.05);}
body.dark button.action{background:#0b79d0;}

/* ===================== Inputs ===================== */
input[type=text], input[type=password], input[type=number]{padding:10px; width:100%; margin:5px 0; border-radius:5px; border:1px solid #ccc;}
body.dark input[type=text], body.dark input[type=password], body.dark input[type=number]{background:#222; color:#eee; border:1px solid #555;}

/* ===================== History Table ===================== */
table{width:100%; border-collapse: collapse; margin-top:10px;}
th, td{border:1px solid #ccc; padding:5px; text-align:center;}
body.dark table, body.dark th, body.dark td{border:1px solid #555;}

/* ===================== Animations ===================== */
@keyframes fadeIn {from{opacity:0;} to{opacity:1;}}
.fade-in{animation:fadeIn 0.3s;}

/* ===================== Pixel Animation ===================== */
.pixel {font-family: monospace; white-space: pre; font-size:12px;}
/* ===================== Mini Game Styles ===================== */
#fish-bar {position: relative; width: 100%; height: 30px; background: #ddd; margin: 10px 0;}
#fish {position: absolute; width: 20px; height: 30px; background: red; left: 0;}
</style>
</head>
<body>

<header>PhongCard Mini Game Nâng Cấp</header>

<!-- ===================== Tabs ===================== -->
<div id="home" class="tab active">
  <h2>Trang chủ</h2>
  <p>Xin chào, <span id="user-name">Khách</span>!</p>
  <p>Coin: <span id="coin">0</span> | Pcoin: <span id="pcoin">0</span> | Lượt quay: <span id="spin-count">0</span></p>
  <button class="action" id="toggle-dark">Dark/Light Mode</button>
</div>

<div id="spin" class="tab">
  <h2>Vòng quay</h2>
  <p>Giá 1 lượt: 1 lượt quay</p>
  <button class="action" id="spin-btn">Quay</button>
  <p id="spin-result"></p>
  <pre id="spin-animation" class="pixel"></pre>
</div>

<div id="code" class="tab">
  <h2>Nhập Giftcode</h2>
  <input type="text" id="giftcode" placeholder="">
  <button class="action" id="redeem-btn">Nhận</button>
  <p id="gift-result"></p>
</div>

<div id="games" class="tab">
  <h2>Kiếm tiền</h2>
  <p>Câu cá (5 Pcoin), Tung xúc xắc (3 Pcoin), Kéo bò (15 Pcoin), Toán (30 Pcoin)</p>
  <button class="action" id="fish-btn">Câu cá</button>
  <div id="fish-bar"><div id="fish"></div></div>
  <button class="action" id="dice-btn">Tung xúc xắc</button>
  <button class="action" id="cow-btn">Kéo bò</button>
  <button class="action" id="math-btn">Chơi Toán</button>
  <div id="math-section" style="display:none;">
    <p id="math-question"></p>
    <input type="number" id="math-answer" placeholder="Nhập đáp án">
    <button class="action" id="math-submit">Xác nhận</button>
    <p id="math-result"></p>
  </div>
  <p id="game-result"></p>
  <pre id="game-animation" class="pixel"></pre>
</div>

<div id="account" class="tab">
  <h2>Tài khoản & Lịch sử</h2>
  <div id="auth-section">
    <input type="text" id="reg-user" placeholder="Tên đăng nhập">
    <input type="password" id="reg-pass" placeholder="Mật khẩu">
    <button class="action" id="register-btn">Đăng ký</button>
    <hr>
    <input type="text" id="login-user" placeholder="Tên đăng nhập">
    <input type="password" id="login-pass" placeholder="Mật khẩu">
    <button class="action" id="login-btn">Đăng nhập</button>
  </div>
  <div id="dash-section" style="display:none;">
    <button class="action" id="logout-btn">Đăng xuất</button>
    <h3>Lịch sử</h3>
    <table id="history-table">
      <tr><th>Thời gian</th><th>Sự kiện</th><th>Coin/Pcoin</th></tr>
    </table>
    <h3>Đổi Pcoin</h3>
    <input type="number" id="exchange-amount" placeholder="Số tiền muốn đổi (VNĐ)">
    <button class="action" id="exchange-btn">Đổi sang VNĐ</button>
    <p id="exchange-result"></p>
  </div>
</div>

<!-- ===================== Menu ===================== -->
<nav>
  <button class="active" data-tab="home">Trang chủ</button>
  <button data-tab="spin">Vòng quay</button>
  <button data-tab="code">Code</button>
  <button data-tab="games">Kiếm tiền</button>
  <button data-tab="account">Tài khoản</button>
</nav>

<!-- ===================== Audio ===================== -->
<audio id="ting-sound" src="https://freesound.org/data/previews/320/320181_5260877-lq.mp3"></audio>

<!-- ===================== Firebase ===================== -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// ===================== Firebase Config =====================
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_BUCKET",
  messagingSenderId: "YOUR_SENDER",
  appId: "YOUR_APP_ID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// ===================== Tab Navigation =====================
const tabs = document.querySelectorAll('.tab');
const navButtons = document.querySelectorAll('nav button');
navButtons.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    navButtons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const target = btn.dataset.tab;
    tabs.forEach(t=>t.classList.remove('active'));
    document.getElementById(target).classList.add('active');
  });
});

// ===================== Dark/Light Mode =====================
document.getElementById('toggle-dark').addEventListener('click', ()=>{
  document.body.classList.toggle('dark');
});

// ===================== Authentication =====================
let currentUser = null;

function updateDash(userData){
  if(currentUser){
    document.getElementById('auth-section').style.display='none';
    document.getElementById('dash-section').style.display='block';
    document.getElementById('user-name').innerText=currentUser.displayName||currentUser.email;
    document.getElementById('coin').innerText=userData.coin||0;
    document.getElementById('pcoin').innerText=userData.pcoin||0;
    document.getElementById('spin-count').innerText=userData.spinCount||0;
    updateHistoryTable(userData.history||[]);
  } else {
    document.getElementById('auth-section').style.display='block';
    document.getElementById('dash-section').style.display='none';
  }
}

// ===================== Register/Login =====================
document.getElementById('register-btn').addEventListener('click', ()=>{
  const email = document.getElementById('reg-user').value.trim()+"@example.com";
  const pass = document.getElementById('reg-pass').value.trim();
  if(!email||!pass){alert('Nhập đầy đủ');return;}
  auth.createUserWithEmailAndPassword(email, pass).then(cred=>{
    currentUser = cred.user;
    db.collection('users').doc(currentUser.uid).set({coin:0,pcoin:0,spinCount:0,history:[]});
    updateDash({coin:0,pcoin:0,spinCount:0,history:[]});
  }).catch(err=>alert(err.message));
});

document.getElementById('login-btn').addEventListener('click', ()=>{
  const email = document.getElementById('login-user').value.trim()+"@example.com";
  const pass = document.getElementById('login-pass').value.trim();
  auth.signInWithEmailAndPassword(email, pass).then(cred=>{
    currentUser = cred.user;
    db.collection('users').doc(currentUser.uid).get().then(doc=>{
      if(doc.exists){
        updateDash(doc.data());
      }
    });
  }).catch(err=>alert(err.message));
});

document.getElementById('logout-btn').addEventListener('click', ()=>{
  auth.signOut().then(()=>{
    currentUser = null;
    updateDash({});
  });
});

// ===================== Helper =====================
const ting = document.getElementById('ting-sound');

function updateHistoryTable(history){
  const table=document.getElementById('history-table');
  table.innerHTML='<tr><th>Thời gian</th><th>Sự kiện</th><th>Coin/Pcoin</th></tr>';
  history.slice().reverse().forEach(h=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${h.time}</td><td>${h.event}</td><td>${h.coinChange>0?'+':''}${h.coinChange} / ${h.p
