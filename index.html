<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PhongCard Mini Game 2025</title>
<style>
/* ===================== Reset & Body ===================== */
* {margin:0; padding:0; box-sizing:border-box;}
body {font-family: Arial, sans-serif; background:#f0f0f0; color:#333; transition: background 0.3s, color 0.3s;}
body.dark {background:#121212; color:#eee;}
a{text-decoration:none; color:inherit;}
button{cursor:pointer;}

/* ===================== Header ===================== */
header{padding:10px; text-align:center; font-size:1.5em; font-weight:bold; background:#2196F3; color:#fff;}
body.dark header{background:#0b79d0;}

/* ===================== Menu ===================== */
nav{position:fixed; bottom:0; left:0; width:100%; display:flex; justify-content:space-around; background:#fff; border-top:1px solid #ccc; transition: background 0.3s, color 0.3s; z-index:1000;}
body.dark nav{background:#1e1e1e; border-top:1px solid #444;}
nav button{flex:1; padding:10px; font-size:1em; border:none; background:none; transition: background 0.3s;}
nav button.active{background:#ddd;}
body.dark nav button.active{background:#333;}

/* ===================== Tabs ===================== */
.tab{display:none; padding:15px; padding-bottom:70px; min-height:80vh; transition:opacity 0.5s;}
.tab.active{display:block; opacity:1; animation:fadeIn 0.5s;}
h2{margin-bottom:10px;}

/* ===================== Buttons ===================== */
button.action{padding:10px 20px; margin:5px 0; border:none; background:#2196F3; color:#fff; border-radius:5px; transition: transform 0.2s;}
button.action:hover{transform:scale(1.05);}
body.dark button.action{background:#0b79d0;}

/* ===================== Inputs ===================== */
input[type=text], input[type=password], input[type=number]{padding:10px; width:100%; margin:5px 0; border-radius:5px; border:1px solid #ccc;}
body.dark input[type=text], body.dark input[type=password], body.dark input[type=number]{background:#222; color:#eee; border:1px solid #555;}

/* ===================== History Table ===================== */
table{width:100%; border-collapse: collapse; margin-top:10px;}
th, td{border:1px solid #ccc; padding:5px; text-align:center;}
body.dark table, body.dark th, body.dark td{border:1px solid #555;}

/* ===================== Animations ===================== */
@keyframes fadeIn {from{opacity:0;} to{opacity:1;}}
.fade-in{animation:fadeIn 0.3s;}

/* ===================== Overlay ===================== */
#overlay{
  position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8);
  display:none; justify-content:center; align-items:center; z-index:2000; color:#fff;
  text-align:center; padding:20px;
  font-size:1.2em; border-radius:10px;
}

/* ===================== Pixel Animation ===================== */
.pixel {font-family: monospace; white-space: pre; font-size:12px;}

/* ===================== Game c√° ===================== */
#fish-area{position:relative; height:50px; background:#a0e0ff; margin:10px 0; border-radius:5px; overflow:hidden;}
#fish{position:absolute; left:0; top:5px; font-size:20px;}

/* ===================== Dice ===================== */
#dice-area{height:80px; display:flex; justify-content:center; align-items:center; font-size:50px;}

/* ===================== Cow ===================== */
#cow-area{height:50px; display:flex; justify-content:center; align-items:center; font-size:40px; margin:10px 0;}

/* ===================== Game To√°n ===================== */
#math-area{margin:10px 0;}
#math-question{font-weight:bold; font-size:1.2em;}
#math-result{margin-top:10px;}

/* ===================== Game N·ªëi t·ª´ ===================== */
#word-area{margin:10px 0;}
#word-result{margin-top:10px;}
#word-count{margin-top:5px; font-weight:bold;}

/* ===================== Exchange ===================== */
#exchange-area{margin-top:10px;}
</style>
</head>
<body>

<header>PhongCard Mini Game 2025</header>

<!-- ===================== Overlay ===================== -->
<div id="overlay"></div>

<!-- ===================== Tabs ===================== -->
<div id="home" class="tab active">
  <h2>Trang ch·ªß</h2>
  <p>Xin ch√†o, <span id="user-name">Kh√°ch</span>!</p>
  <p>Coin: <span id="coin">0</span> | Pcoin: <span id="pcoin">0</span> | L∆∞·ª£t quay: <span id="spin-count">0</span></p>
  <button class="action" id="toggle-dark">Dark/Light Mode</button>
</div>

<div id="spin" class="tab">
  <h2>V√≤ng quay</h2>
  <p>Gi√° 1 l∆∞·ª£t: 1 l∆∞·ª£t quay</p>
  <button class="action" id="spin-btn">Quay</button>
  <p id="spin-result"></p>
  <pre id="spin-animation" class="pixel"></pre>
</div>

<div id="code" class="tab">
  <h2>Nh·∫≠p Giftcode</h2>
  <input type="text" id="giftcode" placeholder="Nh·∫≠p code">
  <button class="action" id="redeem-btn">Nh·∫≠n</button>
  <p id="gift-result"></p>
</div>

<div id="games" class="tab">
  <h2>Ki·∫øm ti·ªÅn</h2>
  <p>C√¢u c√° (5 Pcoin), Tung x√∫c x·∫Øc (3 Pcoin), K√©o b√≤ (15 Pcoin), Game To√°n (30 Pcoin), N·ªëi t·ª´ (100 Pcoin)</p>
  
  <!-- C√¢u c√° -->
  <div id="fish-area"><span id="fish">><(((¬∫></span></div>
  <button class="action" id="fish-btn">C√¢u c√°</button>
  <p id="game-result"></p>
  
  <!-- X√∫c x·∫Øc -->
  <div id="dice-area">üé≤</div>
  <button class="action" id="dice-btn">Tung x√∫c x·∫Øc</button>
  
  <!-- K√©o b√≤ -->
  <div id="cow-area">üêÑ</div>
  <button class="action" id="cow-btn">K√©o b√≤</button>
  
  <!-- Game to√°n -->
  <div id="math-area">
    <div id="math-question"></div>
    <input type="text" id="math-answer" placeholder="Nh·∫≠p k·∫øt qu·∫£">
    <button class="action" id="math-btn">X√°c nh·∫≠n</button>
    <p id="math-result"></p>
  </div>
  
  <!-- Game n·ªëi t·ª´ -->
  <div id="word-area">
    <input type="text" id="word-input" placeholder="Nh·∫≠p t·ª´ n·ªëi ti·∫øp">
    <button class="action" id="word-btn">G·ª≠i t·ª´</button>
    <p id="word-result"></p>
    <p id="word-count">S·ªë l·∫ßn n·ªëi th√†nh c√¥ng: 0</p>
  </div>
</div>

<div id="account" class="tab">
  <h2>T√†i kho·∫£n & L·ªãch s·ª≠</h2>
  <div id="auth-section">
    <input type="text" id="reg-user" placeholder="T√™n ƒëƒÉng nh·∫≠p">
    <input type="password" id="reg-pass" placeholder="M·∫≠t kh·∫©u">
    <button class="action" id="register-btn">ƒêƒÉng k√Ω</button>
    <hr>
    <input type="text" id="login-user" placeholder="T√™n ƒëƒÉng nh·∫≠p">
    <input type="password" id="login-pass" placeholder="M·∫≠t kh·∫©u">
    <button class="action" id="login-btn">ƒêƒÉng nh·∫≠p</button>
  </div>
  <div id="dash-section" style="display:none;">
    <button class="action" id="logout-btn">ƒêƒÉng xu·∫•t</button>
    <h3>L·ªãch s·ª≠</h3>
    <table id="history-table">
      <tr><th>Th·ªùi gian</th><th>S·ª± ki·ªán</th><th>Coin/Pcoin</th></tr>
    </table>
    
    <!-- ƒê·ªïi Pcoin -->
    <div id="exchange-area">
      <input type="number" id="exchange-amount" placeholder="Nh·∫≠p s·ªë Pcoin mu·ªën ƒë·ªïi">
      <button class="action" id="exchange-btn">ƒê·ªïi sang VNƒê</button>
      <p id="exchange-result"></p>
    </div>
  </div>
</div>

<!-- ===================== Menu ===================== -->
<nav>
  <button class="active" data-tab="home">Trang ch·ªß</button>
  <button data-tab="spin">V√≤ng quay</button>
  <button data-tab="code">Code</button>
  <button data-tab="games">Ki·∫øm ti·ªÅn</button>
  <button data-tab="account">T√†i kho·∫£n</button>
</nav>

<!-- ===================== Audio ===================== -->
<audio id="ting-sound" src="https://freesound.org/data/previews/320/320181_5260877-lq.mp3"></audio>

<script>
// ===================== Init LocalStorage =====================
if(!localStorage.getItem('users')) localStorage.setItem('users', JSON.stringify({}));
let users = JSON.parse(localStorage.getItem('users'));
let currentUser = localStorage.getItem('currentUser') || null;

// ===================== Tab Navigation =====================
const tabs = document.querySelectorAll('.tab');
const navButtons = document.querySelectorAll('nav button');
navButtons.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    navButtons.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const target = btn.dataset.tab;
    tabs.forEach(t=>t.classList.remove('active'));
    document.getElementById(target).classList.add('active');
  });
});

// ===================== Dark/Light =====================
document.getElementById('toggle-dark').addEventListener('click', ()=>{
  document.body.classList.toggle('dark');
});

// ===================== Authentication =====================
function updateDash(){
  if(currentUser){
    document.getElementById('auth-section').style.display='none';
    document.getElementById('dash-section').style.display='block';
    document.getElementById('user-name').innerText=currentUser;
    document.getElementById('coin').innerText=users[currentUser].coin||0;
    document.getElementById('pcoin').innerText=users[currentUser].pcoin||0;
    document.getElementById('spin-count').innerText=users[currentUser].spinCount||0;
    updateHistoryTable();
  } else {
    document.getElementById('auth-section').style.display='block';
    document.getElementById('dash-section').style.display='none';
  }
}

document.getElementById('register-btn').addEventListener('click', ()=>{
  const u=document.getElementById('reg-user').value.trim();
  const p=document.getElementById('reg-pass').value.trim();
  if(!u||!p){alert('Nh·∫≠p ƒë·∫ßy ƒë·ªß');return;}
  if(users[u]){alert('T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i'); return;}
  users[u]={coin:0,pcoin:0,history:[],spinCount:0,password:p};
  localStorage.setItem('users', JSON.stringify(users));
  alert('ƒêƒÉng k√Ω th√†nh c√¥ng!');
});

document.getElementById('login-btn').addEventListener('click', ()=>{
  const u=document.getElementById('login-user').value.trim();
  const p=document.getElementById('login-pass').value.trim();
  if(users[u] && users[u].password===p){
    currentUser=u;
    localStorage.setItem('currentUser',currentUser);
    updateDash();
  } else {alert('ƒêƒÉng nh·∫≠p th·∫•t b·∫°i');}
});

document.getElementById('logout-btn').addEventListener('click', ()=>{
  currentUser=null;
  localStorage.removeItem('currentUser');
  updateDash();
});

// ===================== History =====================
function addHistory(event, coinChange, pcoinChange){
  const time=new Date().toLocaleString();
  const entry={time,event,coinChange,pcoinChange};
  users[currentUser].history.push(entry);
  localStorage.setItem('users', JSON.stringify(users));
  updateHistoryTable();
}

function updateHistoryTable(){
  const table=document.getElementById('history-table');
  table.innerHTML='<tr><th>Th·ªùi gian</th><th>S·ª± ki·ªán</th><th>Coin/Pcoin</th></tr>';
  users[currentUser].history.slice().reverse().forEach(h=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${h.time}</td><td>${h.event}</td><td>${h.coinChange>0?'+':''}${h.coinChange} / ${h.pcoinChange>0?'+':''}${h.pcoinChange}</td>`;
    table.appendChild(tr);
  });
  document.getElementById('coin').innerText=users[currentUser].coin||0;
  document.getElementById('pcoin').innerText=users[currentUser].pcoin||0;
  document.getElementById('spin-count').innerText=users[currentUser].spinCount||0;
}

// ===================== Giftcode =====================
document.getElementById('redeem-btn').addEventListener('click', ()=>{
  if(!currentUser){alert('ƒêƒÉng nh·∫≠p tr∆∞·ªõc'); return;}
  const code=document.getElementById('giftcode').value.trim().toUpperCase();
  if(code==='ADMINPHONG'){
    users[currentUser].pcoin=(users[currentUser].pcoin||0)+100000000;
    addHistory('Giftcode ADMINPHONG',0,100000000);
    document.getElementById('gift-result').innerText='Nh·∫≠n 100 tri·ªáu Pcoin th√†nh c√¥ng!';
  } else if(/^PHONGCARD\d{3}$/.test(code)){
    if(users[currentUser].history.find(h=>h.event==='Giftcode '+code)){
      document.getElementById('gift-result').innerText='Code ƒë√£ d√πng';
      return;
    }
    users[currentUser].spinCount = (users[currentUser].spinCount||0)+1;
    addHistory('Giftcode '+code,0,0);
    document.getElementById('gift-result').innerText='Nh·∫≠n +1 l∆∞·ª£t quay th√†nh c√¥ng!';
  } else {
    document.getElementById('gift-result').innerText='Code kh√¥ng h·ª£p l·ªá';
  }
  localStorage.setItem('users', JSON.stringify(users));
  updateDash();
});
