<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PhongCard ‚Äî Si√™u c·∫•p (Coin + Mini-game)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#071026; --card:#0f1a2a; --muted:#9fb3c8;
  --accent1:#60a5fa; --accent2:#6ee7b7; --accent3:#a78bfa;
  --good:#10b981; --bad:#fb7185;
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#e6f2fb;background:var(--bg);-webkit-font-smoothing:antialiased}
.container{max-width:960px;margin:10px auto;padding:12px;min-height:calc(100vh - 88px);display:grid;grid-template-columns:1fr 340px;gap:14px}
@media(max-width:900px){ .container{grid-template-columns:1fr;padding:8px} .right-col{order:2} .left-col{order:1} }

/* header */
header{height:64px;display:flex;align-items:center;padding:8px 14px;border-bottom:1px solid rgba(255,255,255,0.03);gap:12px}
.logo{width:44px;height:44;border-radius:10px;background:linear-gradient(135deg,var(--accent2),var(--accent3));display:flex;align-items:center;justify-content:center;color:#042;font-weight:800}
.brand{display:flex;flex-direction:column}
.title{font-weight:700}
.subtitle{font-size:12px;color:var(--muted)}

/* card */
.card{background:linear-gradient(180deg,var(--glass), rgba(255,255,255,0.01));padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
h2{margin:0 0 6px 0}
.small{font-size:13px;color:var(--muted)}

/* sections */
.section{display:none;opacity:0;transform:translateY(8px);transition:all .32s ease}
.section.active{display:block;opacity:1;transform:none}

/* inputs/buttons */
input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
.row{display:flex;gap:8px;align-items:center}
.btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;background:transparent;color:var(--muted)}
.btn:hover{opacity:0.95}
.btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#042;font-weight:700;border:0;padding:9px 12px;border-radius:10px;cursor:pointer;box-shadow:0 8px 20px rgba(96,165,250,0.08)}

/* bottom nav */
.bottom-nav{position:fixed;left:50%;transform:translateX(-50%);bottom:12px;width:min(980px,96%);display:flex;justify-content:space-between;background:linear-gradient(180deg,rgba(0,0,0,0.22),rgba(0,0,0,0.12));padding:8px;border-radius:14px;border:1px solid rgba(255,255,255,0.03);z-index:90}
.nav-item{flex:1;text-align:center;padding:8px;border-radius:10px;color:var(--muted);cursor:pointer}
.nav-item.active{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:#022;font-weight:700}
.nav-item .icon{font-size:18px;display:block}

/* wheel */
.wheel-wrap{display:flex;flex-direction:column;align-items:center;gap:10px}
.wheel{width:300px;height:300px;border-radius:50%;overflow:hidden;border:12px solid rgba(255,255,255,0.03);position:relative;transition:transform 4s cubic-bezier(.2,.9,.2,1)}
.pointer{width:0;height:0;border-left:20px solid transparent;border-right:20px solid transparent;border-bottom:32px solid var(--accent2);margin-top:-12px}
.slice{position:absolute;width:50%;height:50%;left:50%;top:50%;transform-origin:0 0;display:flex;align-items:center;justify-content:center;font-weight:700}

/* history */
.history-list{max-height:420px;overflow:auto;padding:8px;border-radius:8px;background:rgba(0,0,0,0.06)}
.history-item{padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);margin-bottom:8px}

/* games */
.game-box{display:flex;flex-direction:column;gap:10px;align-items:center}
.dice-row{display:flex;gap:10px;align-items:center}

/* uploads preview */
.bg-preview{width:100%;height:130px;border-radius:8px;background-size:cover;background-position:center;border:1px solid rgba(255,255,255,0.03)}

/* loader overlay */
.loader-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);z-index:200;opacity:0;pointer-events:none;transition:opacity .18s}
.loader-overlay.show{opacity:1;pointer-events:auto}
.loader-box{background:linear-gradient(90deg,var(--accent2),var(--accent1));padding:12px;border-radius:10px;color:#022;font-weight:800}

/* small misc */
.muted-note{color:var(--muted);font-size:13px}
.ripple{position:relative;overflow:hidden}
.ripple:after{content:"";position:absolute;width:6px;height:6px;background:rgba(255,255,255,0.15);left:50%;top:50%;transform:translate(-50%,-50%);border-radius:50%;opacity:0;transition:all .6s}
.ripple:active:after{width:200px;height:200px;opacity:1;transition:all .6s}
@media(max-width:760px){ .container{grid-template-columns:1fr;padding:10px} .wheel{width:260px;height:260px} .bg-preview{height:100px} }
</style>
</head>
<body>

<header>
  <div class="logo">P</div>
  <div class="brand"><div class="title">PhongCard</div><div class="subtitle small">Coin ‚Ä¢ Quay ‚Ä¢ Mini-game</div></div>
  <div style="flex:1"></div>
  <div style="display:flex;gap:8px;align-items:center">
    <div id="coinBadge" class="small">Coin: 0</div>
    <button id="musicToggle" class="btn btn-primary">üéµ Nh·∫°c</button>
  </div>
</header>

<div class="container">
  <!-- LEFT: main pages -->
  <div class="left-col">
    <!-- Home -->
    <section id="homePage" class="card section active">
      <h2>Home ‚Äî Dashboard</h2>
      <p class="muted">Ch√†o m·ª´ng! ƒê√¢y l√† trang Dashboard. Upload ·∫£nh ƒë·ªÉ thay background cho t·ª´ng trang.</p>
      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:12px">
        <div style="flex:1;min-width:160px" class="card">
          <div class="small">T√†i kho·∫£n</div>
          <div id="uiUser" style="font-weight:800;margin-top:8px">Ch∆∞a ƒëƒÉng nh·∫≠p</div>
        </div>
        <div style="flex:1;min-width:160px" class="card">
          <div class="small">Coin</div>
          <div id="uiCoin" style="font-weight:800;margin-top:8px">0 Xu</div>
        </div>
        <div style="flex:1;min-width:160px" class="card">
          <div class="small">L∆∞·ª£t quay</div>
          <div id="uiSpins" style="font-weight:800;margin-top:8px">0</div>
        </div>
      </div>

      <div style="margin-top:12px" class="card">
        <div class="small">·∫¢nh Dashboard</div>
        <div id="homePreview" class="bg-preview" style="margin-top:8px"></div>
        <div class="muted-note" style="margin-top:8px">T·∫£i ·∫£nh l√™n t·ª´ tab T√†i kho·∫£n ‚Üí l∆∞u c·ª•c b·ªô (local).</div>
      </div>
    </section>

    <!-- Giftcode -->
    <section id="redeemPage" class="card section">
      <h2>Nh·∫≠p Giftcode</h2>
      <p class="muted">ƒê·ªãnh d·∫°ng: PHONGCARDxxx (l∆∞·ª£t), PHONGVIPxxx (vip), PHONGGIFTxxx (xu).</p>
      <div class="row" style="margin-top:8px">
        <input id="codeInput" placeholder="Nh·∫≠p code...">
        <button id="applyCode" class="btn-primary ripple">√Åp d·ª•ng</button>
      </div>
      <div id="redeemMsg" class="small" style="margin-top:8px"></div>
      <div class="card" style="margin-top:12px">
        <div class="small">·∫¢nh trang nh·∫≠p code</div>
        <div id="redeemPreview" class="bg-preview" style="margin-top:8px"></div>
      </div>
    </section>

    <!-- Wheel -->
    <section id="wheelPage" class="card section">
      <h2>V√≤ng quay may m·∫Øn</h2>
      <p class="muted">10%‚Üí7k ‚Ä¢ 20%‚Üí5k ‚Ä¢ 40%‚Üí2/3/4k ‚Ä¢ 30%‚ÜíC√¢u chuy·ªán</p>
      <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap;margin-top:12px">
        <div style="flex:1;min-width:280px" class="card">
          <div class="wheel-wrap">
            <div class="pointer"></div>
            <div id="wheel" class="wheel" aria-hidden="true"></div>
            <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
              <button id="spinBtn" class="btn-primary ripple">Quay ngay</button>
              <div id="spinInfo" class="small"></div>
            </div>
            <div id="spinResult" class="small" style="margin-top:8px"></div>
          </div>
        </div>
        <div style="width:300px">
          <div class="card">
            <div class="small">VIP boost</div>
            <div id="vipFlag" class="muted-note" style="margin-top:8px"></div>
          </div>
          <div class="card" style="margin-top:12px">
            <div class="small">·∫¢nh v√≤ng quay</div>
            <div id="wheelPreview" class="bg-preview" style="margin-top:8px"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- History -->
    <section id="historyPage" class="card section">
      <h2>L·ªãch s·ª≠</h2>
      <p class="muted">L·ªãch s·ª≠ ph·∫ßn th∆∞·ªüng g·∫Øn v·ªõi t√†i kho·∫£n.</p>
      <div id="historyList" class="history-list" style="margin-top:10px">Ch∆∞a c√≥ l·ªãch s·ª≠</div>
    </section>

    <!-- Earn (mini-games) -->
    <section id="earnPage" class="card section">
      <h2>Ki·∫øm ti·ªÅn (Mini-game)</h2>
      <p class="muted">Ch·ªçn game ƒë·ªÉ ch∆°i v√† ki·∫øm Xu!</p>

      <div class="card" style="margin-top:10px">
        <h3>Tung x√∫c x·∫Øc</h3>
        <div class="dice-row" style="margin-top:8px">
          <div id="diceA" style="font-size:40px">‚ö™</div>
          <div id="diceB" style="font-size:40px">‚ö™</div>
        </div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="rollBtn" class="btn-primary ripple">Tung</button>
          <div id="rollMsg" class="small" style="align-self:center"></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>C√¢u c√°</h3>
        <div style="margin-top:8px">
          <button id="fishBtn" class="btn-primary ripple">C√¢u</button>
          <div id="fishMsg" class="small" style="margin-top:10px"></div>
        </div>
      </div>

    </section>

    <!-- Account -->
    <section id="accountPage" class="card section">
      <h2>T√†i kho·∫£n</h2>
      <div id="accountBox" style="margin-top:8px">
        <div class="small">B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p</div>
        <div style="margin-top:10px"><button id="openAuth" class="btn-primary ripple">ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</button></div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="small">Upload ·∫£nh cho t·ª´ng trang</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <label class="small">Home<input id="uploadHome" type="file" accept="image/*" style="display:none"></label>
          <label class="small">Giftcode<input id="uploadRedeem" type="file" accept="image/*" style="display:none"></label>
          <label class="small">Wheel<input id="uploadWheel" type="file" accept="image/*" style="display:none"></label>
          <div style="flex:1"></div>
        </div>
        <div class="muted-note" style="margin-top:8px">·∫¢nh l∆∞u c·ª•c b·ªô tr√™n tr√¨nh duy·ªát (localStorage).</div>
      </div>
    </section>

  </div>

  <!-- RIGHT: quick controls -->
  <aside class="right-col">
    <div class="card">
      <div class="small">Nh·∫°c n·ªÅn</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="musicPlay" class="btn-primary ripple">B·∫≠t</button>
        <button id="musicPause" class="btn ripple">T·∫Øt</button>
      </div>
      <div class="muted-note" style="margin-top:8px">LoFi mi·ªÖn ph√≠ t√≠ch h·ª£p s·∫µn.</div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="small">Nh·∫≠p code nhanh</div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="sideCode" placeholder="NH·∫¨P CODE">
        <button id="sideApply" class="btn-primary ripple">OK</button>
      </div>
      <div id="sideMsg" class="small" style="margin-top:8px"></div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="small">Mini l·ªãch s·ª≠</div>
      <div id="miniHistory" class="history-list small" style="margin-top:8px">Ch∆∞a c√≥</div>
    </div>
  </aside>
</div>

<!-- bottom nav -->
<div class="bottom-nav" id="bottomNav">
  <div class="nav-item active" data-target="homePage"><div class="icon">üè†</div><div class="small">Home</div></div>
  <div class="nav-item" data-target="redeemPage"><div class="icon">üéÅ</div><div class="small">Giftcode</div></div>
  <div class="nav-item" data-target="wheelPage"><div class="icon">üé°</div><div class="small">Quay</div></div>
  <div class="nav-item" data-target="historyPage"><div class="icon">üìú</div><div class="small">L·ªãch s·ª≠</div></div>
  <div class="nav-item" data-target="earnPage"><div class="icon">üí∞</div><div class="small">Ki·∫øm</div></div>
  <div class="nav-item" data-target="accountPage" id="navAccount"><div class="icon">üë§</div><div class="small">T√†i kho·∫£n</div></div>
</div>

<!-- loader overlay -->
<div id="loader" class="loader-overlay"><div class="loader-box">ƒêang t·∫£i...</div></div>

<!-- audio LoFi (pixabay free) -->
<audio id="bgMusic" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_7b65e8c3f2.mp3?filename=lofi-chill-11293.mp3" type="audio/mpeg">
</audio>

<!-- modal root -->
<div id="modalRoot"></div>

<script>
/* ============================
   App data model (LocalStorage)
   ============================ */
const KEY='phongcard_pro_v1';
let DB = JSON.parse(localStorage.getItem(KEY) || '{}');
if (!DB.users) DB.users = {};
if (!DB.usedCodes) DB.usedCodes = [];
if (!DB.images) DB.images = {}; // home, redeem, wheel
if (!DB._seeded) {
  // seed sample giftcodes
  for (let i=1;i<=30;i++){ DB['PHONGCARD' + String(i).padStart(3,'0')] = {type:'card'}; }
  DB['PHONGVIP001'] = {type:'vip'}; DB['PHONGGIFT001'] = {type:'gift'};
  DB._seeded=true;
  localStorage.setItem(KEY, JSON.stringify(DB));
}
function saveDB(){ localStorage.setItem(KEY, JSON.stringify(DB)); }

/* session */
let current = localStorage.getItem(KEY + '_session') || null;
if (current && !DB.users[current]) { current = null; localStorage.removeItem(KEY + '_session'); }

/* UI refs */
const sections = document.querySelectorAll('.section');
const navItems = document.querySelectorAll('.nav-item');
const loader = document.getElementById('loader');
const bottomNav = document.getElementById('bottomNav');

const uiUser = document.getElementById('uiUser');
const uiCoin = document.getElementById('uiCoin');
const uiSpins = document.getElementById('uiSpins');
const coinBadge = document.getElementById('coinBadge');

const codeInput = document.getElementById('codeInput');
const applyCodeBtn = document.getElementById('applyCode');
const redeemMsg = document.getElementById('redeemMsg');

const sideCode = document.getElementById('sideCode');
const sideApply = document.getElementById('sideApply');
const sideMsg = document.getElementById('sideMsg');

const historyList = document.getElementById('historyList');
const miniHistory = document.getElementById('miniHistory');

const rollBtn = document.getElementById('rollBtn');
const diceA = document.getElementById('diceA');
const diceB = document.getElementById('diceB');
const rollMsg = document.getElementById('rollMsg');

const fishBtn = document.getElementById('fishBtn');
const fishMsg = document.getElementById('fishMsg');

const spinBtn = document.getElementById('spinBtn');
const wheelEl = document.getElementById('wheel');
const spinResult = document.getElementById('spinResult');
const spinInfo = document.getElementById('spinInfo');
const vipFlag = document.getElementById('vipFlag');

const uploadHome = document.getElementById('uploadHome');
const uploadRedeem = document.getElementById('uploadRedeem');
const uploadWheel = document.getElementById('uploadWheel');
const homePreview = document.getElementById('homePreview');
const redeemPreview = document.getElementById('redeemPreview');
const wheelPreview = document.getElementById('wheelPreview');

const openAuthBtn = document.getElementById('openAuth');
const accountBox = document.getElementById('accountBox');

const musicPlay = document.getElementById('musicPlay');
const musicPause = document.getElementById('musicPause');
const bgMusic = document.getElementById('bgMusic');
const musicToggle = document.getElementById('musicToggle');

/* bottom nav clicks */
navItems.forEach(it => it.addEventListener('click', ()=> {
  const tgt = it.dataset.target; if (!tgt) return;
  navItems.forEach(n=>n.classList.remove('active')); it.classList.add('active');
  navigateTo(tgt);
}));

/* side controls binding */
applyCodeBtn.addEventListener('click', ()=> handleRedeem(codeInput.value));
sideApply.addEventListener('click', ()=> handleRedeem(sideCode.value));
uploadHome.addEventListener('change', e=> handleUpload(e,'home'));
uploadRedeem.addEventListener('change', e=> handleUpload(e,'redeem'));
uploadWheel.addEventListener('change', e=> handleUpload(e,'wheel'));
document.getElementById('openAuth').addEventListener('click', openAuth);
musicPlay.addEventListener('click', ()=> { bgMusic.play(); updateMusicBtn(); });
musicPause.addEventListener('click', ()=> { bgMusic.pause(); updateMusicBtn(); });
musicToggle.addEventListener('click', ()=> { if (bgMusic.paused) bgMusic.play(); else bgMusic.pause(); updateMusicBtn(); });

/* initial music volume */
bgMusic.volume = 0.45;

/* ============================
   Navigation (fast, mobile optimized)
   ============================ */
function showLoader(ms=300){
  loader.classList.add('show');
  loader.classList.add('show'); loader.style.display='flex';
  loader.classList.add('show');
  setTimeout(()=> loader.classList.remove('show'), ms);
  setTimeout(()=> loader.style.display='none', ms+60);
}
async function navigateTo(id){
  // instant-ish: show small loader, swap section
  showLoader(280);
  sections.forEach(s=> s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  if (id==='redeemPage') setTimeout(()=> codeInput.focus(), 120);
  if (id==='wheelPage') renderWheel();
  renderAll();
}

/* ============================
   Auth (register / login / logout)
   ============================ */
function openAuth(){
  const modal = document.createElement('div'); modal.className='modal-back';
  modal.innerHTML = `<div class="card modal" style="width:92%;max-width:420px">
    <h3>ƒêƒÉng nh·∫≠p / ƒêƒÉng k√Ω</h3>
    <input id="authUser" placeholder="T√™n t√†i kho·∫£n (kh√¥ng d·∫•u)" />
    <input id="authPass" placeholder="M·∫≠t kh·∫©u" type="password" />
    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="doLogin" class="btn-primary">ƒêƒÉng nh·∫≠p</button>
      <button id="doReg" class="btn">ƒêƒÉng k√Ω</button>
      <button id="doClose" class="btn">ƒê√≥ng</button>
    </div>
    <div class="muted-note" style="margin-top:10px">L∆∞u d·ªØ li·ªáu c·ª•c b·ªô (localStorage).</div>
  </div>`;
  document.getElementById('modalRoot').appendChild(modal);
  document.getElementById('doClose').onclick = ()=> modal.remove();
  document.getElementById('doReg').onclick = ()=> {
    const u=(document.getElementById('authUser').value||'').trim();
    const p=(document.getElementById('authPass').value||'').trim();
    if (!u||!p) return alert('Nh·∫≠p t√™n v√† m·∫≠t kh·∫©u!');
    if (DB.users[u]) return alert('T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!');
    DB.users[u] = { pass:p, coin:0, spins:0, vipBoost:false, history:[] };
    saveDB();
    current = u; localStorage.setItem(KEY + '_session', current); modal.remove(); toast('ƒêƒÉng k√Ω & ƒëƒÉng nh·∫≠p: '+u); renderAll(); navigateTo('homePage');
  };
  document.getElementById('doLogin').onclick = ()=> {
    const u=(document.getElementById('authUser').value||'').trim();
    const p=(document.getElementById('authPass').value||'').trim();
    if (!DB.users[u] || DB.users[u].pass !== p) return alert('Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!');
    current = u; localStorage.setItem(KEY + '_session', current); modal.remove(); toast('ƒêƒÉng nh·∫≠p: '+u); renderAll(); navigateTo('homePage');
  };
}

/* ============================
   Giftcode logic
   ============================ */
function normalizeCode(s){ return (s||'').trim().toUpperCase(); }
function handleRedeem(raw){
  const code = normalizeCode(raw);
  if (!current) { showTemp(redeemMsg,'ƒêƒÉng nh·∫≠p ƒë·ªÉ d√πng code',true); return; }
  if 
