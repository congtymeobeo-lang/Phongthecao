<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Giftcode Web</title>
  <style>
    * {margin:0;padding:0;box-sizing:border-box;font-family:Arial, sans-serif;}
    body {background:#111;color:#fff;overflow-x:hidden;}
    .hidden {display:none;}
    .center {display:flex;align-items:center;justify-content:center;}
    .page {padding:20px;animation:fadeIn .5s;}
    @keyframes fadeIn {from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
    /* Loading */
    #loading {position:fixed;top:0;left:0;width:100%;height:100%;background:#111;color:#fff;z-index:9999;display:none;align-items:center;justify-content:center;font-size:22px;}
    /* Bottom Menu */
    nav {position:fixed;bottom:0;left:0;width:100%;height:60px;background:#222;display:flex;justify-content:space-around;align-items:center;box-shadow:0 -2px 6px rgba(0,0,0,.5);}
    nav button {flex:1;background:none;border:none;color:#aaa;font-size:14px;transition:.3s;cursor:pointer;padding:10px;}
    nav button.active {color:#fff;font-weight:bold;}
    nav button:active {transform:scale(0.95);}
    /* Auth */
    #auth {height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;}
    #auth input {margin:8px 0;padding:10px;width:80%;border-radius:6px;border:none;}
    #auth button {margin:8px 0;padding:10px 20px;border:none;border-radius:6px;cursor:pointer;background:#28a745;color:#fff;font-size:16px;}
    #auth h2 {margin-bottom:20px;}
    /* Wheel */
    #wheel {width:250px;height:250px;border-radius:50%;border:10px solid #fff;position:relative;overflow:hidden;transition:transform 5s cubic-bezier(0.17,0.67,0.83,0.67);}
    #wheel div {position:absolute;width:50%;height:50%;background:#f39c12;transform-origin:100% 100%;text-align:center;line-height:120px;font-weight:bold;color:#000;}
    #spin {margin-top:20px;padding:10px 20px;background:#e74c3c;border:none;border-radius:6px;color:#fff;font-size:16px;cursor:pointer;}
    /* Result Popup */
    #resultPopup {position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:#222;padding:20px;border-radius:10px;color:#fff;text-align:center;z-index:10000;transition:.4s;}
    #resultPopup.show {transform:translate(-50%,-50%) scale(1);}
    /* Giftcode */
    #giftcode input {padding:10px;width:70%;border:none;border-radius:6px;margin-right:10px;}
    #giftcode button {padding:10px 15px;border:none;border-radius:6px;background:#3498db;color:#fff;cursor:pointer;}
    /* History */
    #history ul {list-style:none;padding:0;}
    #history li {padding:10px;margin:5px 0;background:#333;border-radius:6px;animation:fadeIn .5s;}
  </style>
</head>
<body>

<div id="loading" class="center">Đang tải...</div>

<!-- Auth Page -->
<div id="auth">
  <h2>Đăng nhập / Đăng ký</h2>
  <input type="text" id="username" placeholder="Tài khoản">
  <input type="password" id="password" placeholder="Mật khẩu">
  <button onclick="register()">Đăng ký</button>
  <button onclick="login()">Đăng nhập</button>
</div>

<!-- Main Pages -->
<div id="app" class="hidden">
  <div id="home" class="page"> 
    <h2>Trang chủ</h2>
    <p>Chào mừng bạn đến với Shop Giftcode 🎉</p>
  </div>
  <div id="giftcode" class="page hidden">
    <h2>Nhập Giftcode</h2>
    <input type="text" id="codeInput" placeholder="Nhập code...">
    <button onclick="redeemCode()">Xác nhận</button>
  </div>
  <div id="spinPage" class="page hidden center" style="flex-direction:column;">
    <h2>Vòng quay may mắn</h2>
    <div id="wheel"></div>
    <button id="spin" onclick="spinWheel()">Quay</button>
  </div>
  <div id="history" class="page hidden">
    <h2>Lịch sử phần thưởng</h2>
    <ul id="historyList"></ul>
  </div>
  <div id="account" class="page hidden">
    <h2>Tài khoản</h2>
    <p id="accInfo"></p>
    <button onclick="logout()">Đăng xuất</button>
  </div>
</div>

<!-- Bottom Menu -->
<nav id="menu" class="hidden">
  <button onclick="showPage('home')">🏠 Home</button>
  <button onclick="showPage('giftcode')">📜 Giftcode</button>
  <button onclick="showPage('spinPage')">🎁 Quay</button>
  <button onclick="showPage('history')">📖 Lịch sử</button>
  <button onclick="showPage('account')">👤 Tài khoản</button>
</nav>

<!-- Result Popup -->
<div id="resultPopup"></div>

<script>
  let currentUser=null;
  let users=JSON.parse(localStorage.getItem("users")||"{}");
  let prizes=[
    {text:"7,000đ",chance:10},
    {text:"5,000đ",chance:20},
    {text:"2,000đ",chance:20},
    {text:"3,000đ",chance:10},
    {text:"4,000đ",chance:10},
    {text:"Câu chuyện",chance:30}
  ];
  function saveUsers(){localStorage.setItem("users",JSON.stringify(users));}
  function register(){
    let u=document.getElementById("username").value;
    let p=document.getElementById("password").value;
    if(!u||!p){alert("Nhập đủ tài khoản và mật khẩu!");return;}
    if(users[u]){alert("Tài khoản đã tồn tại!");return;}
    users[u]={password:p,history:[],spins:0};
    saveUsers();alert("Đăng ký thành công!");}
  function login(){
    let u=document.getElementById("username").value;
    let p=document.getElementById("password").value;
    if(users[u]&&users[u].password===p){currentUser=u;localStorage.setItem("currentUser",u);loadApp();}
    else alert("Sai tài khoản hoặc mật khẩu!");}
  function loadApp(){
    document.getElementById("auth").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    document.getElementById("menu").classList.remove("hidden");
    document.getElementById("accInfo").innerText="Xin chào, "+currentUser;
    showPage("home");renderHistory();}
  function logout(){localStorage.removeItem("currentUser");location.reload();}
  function showPage(id){
    document.getElementById("loading").style.display="flex";
    setTimeout(()=>{
      document.querySelectorAll("#app .page").forEach(p=>p.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
      [...document.querySelectorAll("nav button")].find(b=>b.textContent.includes(id.charAt(0).toUpperCase())).classList.add("active");
      document.getElementById("loading").style.display="none";
    },500);
  }
  function redeemCode(){
    let code=document.getElementById("codeInput").value.trim();
    if(!code){alert("Nhập code!");return;}
    users[currentUser].spins=(users[currentUser].spins||0)+1;
    saveUsers();alert("Đã nhận 1 lượt quay!");document.getElementById("codeInput").value="";
  }
  let spinning=false;
  function spinWheel(){
    if(spinning)return;
    if(users[currentUser].spins<=0){alert("Bạn chưa có lượt quay!");return;}
    spinning=true;
    users[currentUser].spins--;saveUsers();
    let total=prizes.reduce((a,b)=>a+b.chance,0);
    let r=Math.random()*total,sum=0,result;
    for(let p of prizes){sum+=p.chance;if(r<sum){result=p.text;break;}}
    let wheel=document.getElementById("wheel");
    let deg=3600+Math.floor(Math.random()*360);
    wheel.style.transform="rotate("+deg+"deg)";
    setTimeout(()=>{
      showResult(result);
      users[currentUser].history.push(result);
      saveUsers();renderHistory();spinning=false;
    },5000);
  }
  function showResult(t){
    let pop=document.getElementById("resultPopup");
    pop.innerText="Bạn nhận được: "+t;
    pop.classList.add("show");
    setTimeout(()=>pop.classList.remove("show"),2500);
  }
  function renderHistory(){
    let list=document.getElementById("historyList");
    list.innerHTML="";
    (users[currentUser].history||[]).forEach(item=>{
      let li=document.createElement("li");
      li.innerText=item;
      list.appendChild(li);
    });
  }
  // Auto login
  let saved=localStorage.getItem("currentUser");
  if(saved&&users[saved]){currentUser=saved;loadApp();}
  // Build wheel slices
  let wheel=document.getElementById("wheel");let angle=0;
  prizes.forEach((p,i)=>{let d=document.createElement("div");d.style.transform="rotate("+angle+"deg)";d.style.background=i%2?"#f1c40f":"#e67e22";d.innerText=p.text;wheel.appendChild(d);angle+=60;});
</script>
</body>
</html>
